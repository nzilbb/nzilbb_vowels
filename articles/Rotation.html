<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>PCA and Rotation • nzilbb.vowels</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="PCA and Rotation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nzilbb.vowels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Model-to-PCA-workflow.html">Model-to-PCA workflow</a></li>
    <li><a class="dropdown-item" href="../articles/Rotation.html">PCA and Rotation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://joshua.wilsonblack.nz/posts/nzilbb-vowels-0-3-1/">nzilbb.vowels 0.3.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nzilbb/nzilbb_vowels/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>PCA and Rotation</h1>
                        <h4 data-toc-skip class="author">Joshua Wilson Black</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nzilbb/nzilbb_vowels/blob/v0.4.1/vignettes/articles/Rotation.Rmd" class="external-link"><code>vignettes/articles/Rotation.Rmd</code></a></small>
      <div class="d-none name"><code>Rotation.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="why-rotate">
<span class="header-section-number">1</span> Why rotate?<a class="anchor" aria-label="anchor" href="#why-rotate"></a>
</h2>
<p>It is often useful to apply rotations to the outputs of PCA. This article
demonstrates a few options for rotation using functions from <code>nzilbb.vowels</code>.</p>
<p>First, we discuss the use of rotation for comparing PCA applied across
distinct data sets.</p>
<p>We then discuss the use of rotation for PCA applied to a single dataset.</p>
<p><strong>NB:</strong> This page should be taken as work-in-progress!</p>
</div>
<div class="section level2" number="2">
<h2 id="packages">
<span class="header-section-number">2</span> Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>Let’s load some packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nzilbb.github.io/nzilbb_vowels/">nzilbb.vowels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GAMMS</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">itsadug</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for bootstrapping</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="comparing-pca-across-two-data-sets">
<span class="header-section-number">3</span> Comparing PCA across two data sets<a class="anchor" aria-label="anchor" href="#comparing-pca-across-two-data-sets"></a>
</h2>
<div class="section level3" number="3.1">
<h3 id="are-the-same-patterns-of-covariation-present-in-two-data-sets">
<span class="header-section-number">3.1</span> Are the same patterns of covariation present in two data sets?<a class="anchor" aria-label="anchor" href="#are-the-same-patterns-of-covariation-present-in-two-data-sets"></a>
</h3>
<p><span class="citation">Hurring et al. (Forthcoming)</span> show that similar patterns of covariation
are present in data from the ONZE corpus and the QuakeBox corpus, two
distinct corpora of New Zealand English (NZE).</p>
<p>In order to mimic the results of <span class="citation">Hurring et al. (Forthcoming)</span> we apply the model-to-PCA
pipeline to the <code>qb_vowels</code> data included in <code>nzilbb.vowels</code>. This dataset
is a small subset of the data considered by <span class="citation">Hurring et al. (Forthcoming)</span> It contains 11
speakers for each of 7 age categories, but is not balanced by gender.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_models</span> <span class="op">&lt;-</span> <span class="va">qb_vowels</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># normalize</span></span>
<span>  <span class="fu"><a href="../reference/lobanov_2.html">lobanov_2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F1_lob2"</span>, <span class="st">"F2_lob2"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"formant_type"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"formant_value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># changes for compatibility with GAMM modellings.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    speaker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>    word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span>,</span>
<span>    gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">participant_gender</span><span class="op">)</span>,</span>
<span>    age_numeric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">participant_age_category</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># We'll remove FOOT</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">vowel</span> <span class="op">!=</span> <span class="st">"FOOT"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vowel</span>, <span class="va">formant_type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">data</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span></span>
<span>        <span class="va">formant_value</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">age_numeric</span>, by<span class="op">=</span><span class="va">gender</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">word_freq</span>, k<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">articulation_rate</span>, k<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">word</span>, bs<span class="op">=</span><span class="st">"re"</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">speaker</span>, bs<span class="op">=</span><span class="st">"re"</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>        discrete <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        nthreads <span class="op">=</span> <span class="fl">8</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at the predictions from these models. The code below is
borrowed from the model-to-PCA vignette.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">to_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"age_numeric"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>, to<span class="op">=</span><span class="fl">7</span>, by<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, <span class="co"># All age categories.</span></span>
<span>  <span class="st">"gender"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">qb_preds</span> <span class="op">&lt;-</span> <span class="va">qb_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    prediction <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">model</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/get_predictions.html" class="external-link">get_predictions</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">.x</span>, cond <span class="op">=</span> <span class="va">to_predict</span>, print.summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">vowel</span>, <span class="va">formant_type</span>, <span class="va">prediction</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">age_numeric</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span> <span class="co"># Pivot</span></span>
<span>    names_from <span class="op">=</span> <span class="va">formant_type</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">CI</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    F1_lob2 <span class="op">=</span> <span class="va">fit_F1_lob2</span>,</span>
<span>    F2_lob2 <span class="op">=</span> <span class="va">fit_F2_lob2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">vowel_colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  DRESS <span class="op">=</span> <span class="st">"#777777"</span>, <span class="co"># This is the 'bad data' colour for maps</span></span>
<span>  FLEECE <span class="op">=</span> <span class="st">"#882E72"</span>,</span>
<span>  GOOSE <span class="op">=</span> <span class="st">"#4EB265"</span>,</span>
<span>  KIT <span class="op">=</span> <span class="st">"#7BAFDE"</span>,</span>
<span>  LOT <span class="op">=</span> <span class="st">"#DC050C"</span>,</span>
<span>  TRAP <span class="op">=</span> <span class="st">"#878100"</span>, <span class="co"># "#F7F056",</span></span>
<span>  START <span class="op">=</span> <span class="st">"#1965B0"</span>,</span>
<span>  STRUT <span class="op">=</span> <span class="st">"#F4A736"</span>,</span>
<span>  THOUGHT <span class="op">=</span> <span class="st">"#72190E"</span>,</span>
<span>  NURSE <span class="op">=</span> <span class="st">"#E8601C"</span>,</span>
<span>  FOOT <span class="op">=</span> <span class="st">"#5289C7"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add labels to data for plotting purposes</span></span>
<span><span class="va">qb_preds</span> <span class="op">&lt;-</span> <span class="va">qb_preds</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vowel</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      vowel_lab <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>        <span class="va">age_numeric</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">age_numeric</span><span class="op">)</span>,</span>
<span>        <span class="va">vowel</span>,</span>
<span>        <span class="st">""</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qb_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">F2_lob2</span>,</span>
<span>      y <span class="op">=</span> <span class="va">F1_lob2</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">vowel</span>,</span>
<span>      label <span class="op">=</span> <span class="va">vowel_lab</span>,</span>
<span>      group <span class="op">=</span> <span class="va">vowel</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span></span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span></span>
<span>        ends <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>        type<span class="op">=</span><span class="st">"closed"</span>,</span>
<span>        length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="va">vowel_lab</span> <span class="op">==</span> <span class="st">""</span></span>
<span>      <span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span></span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">10</span> <span class="op">/</span> <span class="va">.pt</span>,</span>
<span>    label.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    max.overlaps <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">vowel_colours</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"F2 (normalised)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"F1 (normalised)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position<span class="op">=</span><span class="st">"none"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-qb-preds"></span>
<img src="Rotation_files/figure-html/fig-qb-preds-1.png" alt="Predictions from QuakeBox models." width="100%"><p class="caption">
Figure 3.1: Predictions from QuakeBox models.
</p>
</div>
<p>The trajectories in Figure <a href="#fig:fig-qb-preds">3.1</a> are in line with those found in
<span class="citation">Hurring et al. (Forthcoming)</span>. As we’re interested in PCA rotation here,
we’ll skip model criticism and go straight to extracting random intercepts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_intercepts</span> <span class="op">&lt;-</span> <span class="va">qb_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    random_intercepts <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">model</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/get_random.html" class="external-link">get_random</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">`s(speaker)`</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"speaker"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">vowel</span>, <span class="va">formant_type</span>, <span class="va">random_intercepts</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">random_intercepts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">vowel</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Combine the 'vowel' and 'formant_type' columns as a string.</span></span>
<span>    vowel_formant <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="va">vowel</span>, <span class="st">'_'</span>, <span class="va">formant_type</span><span class="op">)</span>,</span>
<span>    <span class="co"># Remove '_lob2' for cleaner column names</span></span>
<span>    vowel_formant <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">vowel_formant</span>, <span class="st">'_lob2'</span>, <span class="st">''</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Remove old 'vowel' and 'formant_type' columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vowel</span>, <span class="va">formant_type</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Make data 'wider', by...</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">vowel_formant</span>, <span class="co"># naming columns using 'vowel_formant'...</span></span>
<span>    values_from <span class="op">=</span> <span class="va">intercept</span> <span class="co"># and values from intercept column</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># take only complete cases (some speakers don't have enough vowels for models)</span></span>
<span>  <span class="co"># NB: a use for the magrittr pipe rather than the native R pipe.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now let’s do some PCA with these new intercepts and with the onze intercepts
from <span class="citation">Brand et al. (2021)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_pca_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_test.html">pca_test</a></span><span class="op">(</span></span>
<span>  <span class="va">qb_intercepts</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change variable names to match QB. QB names are of form VOWEL_FORMANT. ONZE</span></span>
<span><span class="co"># names are of formant FORMANT_VOWEL. </span></span>
<span><span class="va">onze_intercepts_full</span> <span class="op">&lt;-</span> <span class="va">onze_intercepts_full</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"_([A-Z]*)"</span>, group<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      <span class="st">"_"</span>,</span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"F[1-2]"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"F[0-9]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">onze_pca_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_test.html">pca_test</a></span><span class="op">(</span></span>
<span>  <span class="va">onze_intercepts_full</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We’ll look at the variances explained by each.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_variance_explained.html">plot_variance_explained</a></span><span class="op">(</span><span class="va">qb_pca_test</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-qb-var"></span>
<img src="Rotation_files/figure-html/fig-qb-var-1.png" alt="Variance explained by QB PCs." width="100%"><p class="caption">
Figure 3.2: Variance explained by QB PCs.
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_variance_explained.html">plot_variance_explained</a></span><span class="op">(</span><span class="va">onze_pca_test</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-onze-var"></span>
<img src="Rotation_files/figure-html/fig-onze-var-1.png" alt="Variance explained by ONZE PCs." width="100%"><p class="caption">
Figure 3.3: Variance explained by ONZE PCs.
</p>
</div>
<p>Let’s look at the first two PCs of each to see if there’s any similarity in
the patterns which emerge.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB"</span> <span class="op">=</span> <span class="va">qb_pca_test</span><span class="op">$</span><span class="va">loadings</span>,</span>
<span>  <span class="st">"ONZE"</span> <span class="op">=</span> <span class="va">onze_pca_test</span><span class="op">$</span><span class="va">loadings</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="st">"PC"</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">low_null</span><span class="op">:</span><span class="va">sig_loading</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># annoyingly the variables are of form Fx_VOWEL in ONZE and VOWEL_Fx in QB.</span></span>
<span>  <span class="co"># we change to match QB</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">loading_PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">loading_PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">loading_PC1</span>, y <span class="op">=</span> <span class="va">loading_PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-pc1-pc2-loadings"></span>
<img src="Rotation_files/figure-html/fig-pc1-pc2-loadings-1.png" alt="Loadings for PC1 and PC2 across ONZE and QB." width="100%"><p class="caption">
Figure 3.4: Loadings for PC1 and PC2 across ONZE and QB.
</p>
</div>
<p>Spend some time peering at Figure <a href="#fig:fig-pc1-pc2-loadings">3.4</a>. You will start to see patterns
which are common to both, but which are not captured by just looking at PC1
or PC2.</p>
<p><span class="citation">Hurring et al. (Forthcoming)</span> focuses on <em>similarity</em> between the two corpora
and finds this by means of looking at loadings by themselves. They find a nice
correspondence between PC2 in ONZE and PC1 in QB.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;This is less clear in
Figure &lt;a href="#fig:fig-pc1-pc2-loadings"&gt;3.4&lt;/a&gt;, which uses only a subset of the QB data.&lt;/p&gt;'><sup>1</sup></a>
It was nice for their argument that nothing special was done to the PCs which
might suggest rigging things in favour of finding similarities.</p>
<p>If, instead, we’re interested in meaningful <em>differences</em> between patterns in
the two corpora. We might want to maximise the <em>similarity</em> between the two
before interpreting differences. This can be achieved by rotation.</p>
<p>At this point it is worth emphasising the variance of PCA in the sense of large
changes in PC loadings with small changes in the input data. Variance in loadings
is particularly high in cases where there are multiple PCs which explain similar
amounts of variance to one another. This is the point of the confidence intervals
around the plots of variance explained above. If, as in Figure <a href="#fig:fig-onze-var">3.3</a>,
PC1 and PC2 have overlapping confidence intervals, then we expect that there
will be a lot of variance in which variables get loaded on which PC (or on
some combination of both PCs).</p>
<p>This kind of instability can be very
easily visualised by showing PC1 and PC2 for the ONZE data across 15 bootstrapped
samples.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_boots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/bootstraps.html" class="external-link">bootstraps</a></span><span class="op">(</span><span class="va">onze_intercepts_full</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">onze_bootstrapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  iteration <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>  pca <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    <span class="va">data_boots</span><span class="op">$</span><span class="va">splits</span>,</span>
<span>    <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>,</span>
<span>      scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">onze_bootstrapped</span> <span class="op">&lt;-</span> <span class="va">onze_bootstrapped</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    PC1_loadings <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span> </span>
<span>      <span class="va">pca</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    PC2_loadings <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">pca</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">pca</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">onze_loadings</span> <span class="op">&lt;-</span> <span class="va">onze_bootstrapped</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># ditch 'scores' columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">'_scores'</span><span class="op">)</span>, <span class="op">-</span><span class="va">pca</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">PC1_loadings</span>, <span class="va">PC2_loadings</span>, <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    PC1 <span class="op">=</span> <span class="va">PC1_loadings</span>,</span>
<span>    PC2 <span class="op">=</span> <span class="va">PC2_loadings</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    pattern <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"THOUGHT_F2"</span>, <span class="st">"STRUT_F2"</span>, <span class="st">"THOUGHT_F1"</span>, <span class="st">"START_F2"</span><span class="op">)</span> <span class="op">~</span></span>
<span>        <span class="st">"Back vowel configuration"</span>,</span>
<span>      <span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"TRAP_F1"</span>, <span class="st">"KIT_F2"</span>, <span class="st">"FLEECE_F1"</span>, <span class="st">"NURSE_F1"</span>, <span class="st">"LOT_F2"</span>, <span class="st">"DRESS_F1"</span></span>
<span>      <span class="op">)</span> <span class="op">~</span> <span class="st">"Leader/lagger"</span>,</span>
<span>      .default <span class="op">=</span> <span class="st">"Other"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">anim</span> <span class="op">&lt;-</span> <span class="va">onze_loadings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      y <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span>,</span>
<span>      group <span class="op">=</span> <span class="va">variable</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">pattern</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    <span class="co">#show.legend = FALSE,</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    size <span class="op">=</span> <span class="fl">5</span>, </span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Leader/lagger"</span> <span class="op">=</span> <span class="st">"#F95A5C"</span>, </span>
<span>      <span class="st">"Back vowel configuration"</span> <span class="op">=</span> <span class="st">"#425B78"</span>,</span>
<span>      <span class="st">"Other"</span> <span class="op">=</span> <span class="st">"grey"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    caption <span class="op">=</span> <span class="st">"Bootstrap: {closest_state}/15"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"Vowel pattern"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_states.html" class="external-link">transition_states</a></span><span class="op">(</span></span>
<span>    <span class="va">iteration</span>,</span>
<span>    transition_length <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    state_length <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">anim</span>, nframes <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-bootstrap-plot"></span>
<img src="Rotation_files/figure-html/fig-bootstrap-plot-1.gif" alt="Variation in PC1 and PC2 loadings (ONZE)." width="100%"><p class="caption">
Figure 3.5: Variation in PC1 and PC2 loadings (ONZE).
</p>
</div>
<p>The moral of Figure <a href="#fig:fig-bootstrap-plot">3.5</a> is that the same <em>patterns</em> are pretty
consistent even if they switch between PC1 and PC2 or their polarity switches
from negative to positive. The red collection of arrows and the blue collections
of arrows show the ‘leader/lagger’ and the ‘back vowel configuration’ patterns
identified by Brand et al. These relative positions of the arrows in these
patterns <em>is</em> consistent, but they are captured differently in PC1 and PC2 space
in different samples from the original data.</p>
<p>When it comes to comparing ONZE with QB, we are not interested if a pattern is
captured by PC1 in one corpus and PC2 in the other. This <em>might</em> indicate
something about the relative strength of the patterns in the community, but
<em>only</em> if the confidence intervals for variance explained by PC1 and PC2 did
not overlap for <em>both</em> corpora (i.e., both Figure <a href="#fig:fig-onze-var">3.3</a> and Figure <a href="#fig:fig-qb-var">3.2</a> show
PCs which do not have overlapping confidence intervals).</p>
<div class="section level4" number="3.1.1">
<h4 id="manual-rotation">
<span class="header-section-number">3.1.1</span> Manual rotation<a class="anchor" aria-label="anchor" href="#manual-rotation"></a>
</h4>
<p>Sometimes, if we are working with two PCs, it’s easiest to just decide how much
we want to rotate a space and manually do it. <code>nzilbb.vowels</code> includes the
<code><a href="../reference/pca_rotate_2d.html">pca_rotate_2d()</a></code> to rotate PCs in two dimensions. It works for the output
of <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code> and <code><a href="https://rdrr.io/r/stats/princomp.html" class="external-link">princomp()</a></code>, but not for the output of <code><a href="../reference/pca_test.html">pca_test()</a></code>.</p>
<p>Let’s repeat Figure <a href="#fig:fig-pc1-pc2-loadings">3.4</a> with <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="va">qb_intercepts</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">onze_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="va">onze_intercepts_full</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">qb_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"ONZE"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-loadings"></span>
<img src="Rotation_files/figure-html/fig-loadings-1.png" alt="ONZE and QB loadings for PC1 and PC2 before rotation." width="100%"><p class="caption">
Figure 3.6: ONZE and QB loadings for PC1 and PC2 before rotation.
</p>
</div>
<p>Let’s align ONZE with QB. Visually, we can see that this is possible by rotating
<code>TRAP_F1</code> in both along PC1. A roughly 90 degree clockwise rotation would
achieve this. Let’s do it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_rot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_rotate_2d.html">pca_rotate_2d</a></span><span class="op">(</span><span class="va">onze_pca</span>, <span class="fl">90</span>, pcs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">qb_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"ONZE (Rotated)"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_rot</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-rot-loadings"></span>
<img src="Rotation_files/figure-html/fig-rot-loadings-1.png" alt="ONZE and QB loadings for components 1 and 2, ONZE rotated." width="100%"><p class="caption">
Figure 3.7: ONZE and QB loadings for components 1 and 2, ONZE rotated.
</p>
</div>
<p>Figure <a href="#fig:fig-rot-loadings">3.7</a> roughly aligns the first component in ONZE with the first
PC in QB.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;strong&gt;NB&lt;/strong&gt;: I no longer refer to the components from ONZE as “PCs”.&lt;/p&gt;"><sup>2</sup></a>
It looks like the second component would be more similar if we also flip the
ONZE second component. Let’s do this using the <code><a href="../reference/pc_flip.html">pc_flip()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_rot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pc_flip.html">pc_flip</a></span><span class="op">(</span><span class="va">onze_rot</span>, pc_no<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">qb_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"ONZE (Rotated and flipped)"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_rot</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-rot-flip-loadings"></span>
<img src="Rotation_files/figure-html/fig-rot-flip-loadings-1.png" alt="ONZE and QB loadings for components 1 and 2, ONZE manually rotated and then flipped on Component 2." width="100%"><p class="caption">
Figure 3.8: ONZE and QB loadings for components 1 and 2, ONZE manually rotated and then flipped on Component 2.
</p>
</div>
<p>It is only arguable that this flip improves things. We could test this using
correlations, but it would better to switch to a less impressionistic method.
Nonetheless, simple 2D rotations and flips, manually applied, are sometimes
all that you need.</p>
</div>
<div class="section level4" number="3.1.2">
<h4 id="procrustes-rotation">
<span class="header-section-number">3.1.2</span> Procrustes rotation<a class="anchor" aria-label="anchor" href="#procrustes-rotation"></a>
</h4>
<p>Procrustes rotation produces the closest alignment between two shapes which is
possible using scaling and rotation. The two shapes must have the same landmarks
as each other. In our case, the shape is the position of each of our variables
in the space defined by the PCs, that is, the <strong>loadings</strong>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If you have the
same individuals in two data sets, you could do a rotation to align the
individuals and then look at the relationship between the PCs. This would not
rely on having the same variables in the two data sets. I have not had reason
to attempt this yet in an actual research problem, but the methods should be
applicable with minimal changes.&lt;/p&gt;"><sup>3</sup></a></p>
<p>Underlying this method is the <code>procrustes()</code> function from the <code>vegan</code> package.
As with the other uses of PCA in the NZILBB research programme that
<code>nzilbb.vowels</code> has emerged from, we are close to ‘ordination’ methods used in
community ecology. <code>vegan</code> is a package from community ecology. For
<code>nzilbb.vowels</code>, I have hidden the options which explicitly use the language of
‘species’ and ‘site’. The <code>nzilbb.vowels</code> function is called
<code><a href="../reference/pca_rotate_procrustes.html">pca_rotate_procrustes()</a></code>.</p>
<p>We will now maximally align the QB and ONZE PCA analyses using Procrustes
rotation. We have to choose how many PCs to include when we do this. For the
purposes of this illustration, we will choose the first five PCs, because the
ONZE data has five statistically significant PCs according to <code><a href="../reference/pca_test.html">pca_test()</a></code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;See
Figure &lt;a href="#fig:fig-onze-var"&gt;3.3&lt;/a&gt;.&lt;/p&gt;'><sup>4</sup></a> We will again rotate ONZE to match QB (but we could
easily go the other way).</p>
<p><strong>NB</strong>: We have to ensure that the order in which the variables appear in the
data which goes into <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code> is the same across the two PCAs. This is how
the Procrustes function knows</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_proc</span> <span class="op">&lt;-</span> <span class="va">onze_pca</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/pca_rotate_procrustes.html">pca_rotate_procrustes</a></span><span class="op">(</span>target <span class="op">=</span> <span class="va">qb_pca</span>, max_pcs <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">qb_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"ONZE (Rotated)"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_proc</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-qb-onze-proc"></span>
<img src="Rotation_files/figure-html/fig-qb-onze-proc-1.png" alt="First two components of QB PCA and Procrustes rotated ONZE PCA." width="100%"><p class="caption">
Figure 3.9: First two components of QB PCA and Procrustes rotated ONZE PCA.
</p>
</div>
<p>How does this compare to the manual rotation we tried above (Figure <a href="#fig:fig-rot-flip-loadings">3.8</a>)?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"ONZE manual"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_rot</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"ONZE Procrustes"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_proc</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-manual-proc"></span>
<img src="Rotation_files/figure-html/fig-manual-proc-1.png" alt="ONZE PCA rotated manually and via Procrustes rotation." width="100%"><p class="caption">
Figure 3.10: ONZE PCA rotated manually and via Procrustes rotation.
</p>
</div>
<p>The biggest difference between the two approaches is that this Procrustes
rotation is a five dimensional rotation, whereas the manual rotation is only
2D. Information from any of the first 5 dimensions picked up by Procrustes
rotation can now appear in Component 1 or Component 2, with the aim of matching
the patterns present in the first five PCs of the QuakeBox.</p>
<p>The manual rotation, in this case, does more closely match the interpretation
where Component 1 measures something like ‘leader/lagger’ status and the
second component gives us some kind of change in back vowel configuration. This
is unsurprising, as that interpretation is what motivated the selection of
the manual rotation which we applied!</p>
</div>
</div>
<div class="section level3" number="3.2">
<h3 id="partial-overlap-of-variables-and-rotation-on-scores">
<span class="header-section-number">3.2</span> Partial overlap of variables and rotation on scores<a class="anchor" aria-label="anchor" href="#partial-overlap-of-variables-and-rotation-on-scores"></a>
</h3>
<p>In some cases, we might have partially overlapping variables in our two PCA
analyses. Upcoming work on bilingualism faces this problem, where only some
vowel categories can be aligned across languages.</p>
<p>There is no special issue for manual 2D rotations. The problem is slightly
more serious for Procrustes rotation. The solution is to work out the rotation
using the shared landmarks and then apply the rotation to all variables.</p>
<p>We can specify which landmarks to use <em>via</em> the <code>rotation_variables</code>
argument to <code><a href="../reference/pca_rotate_procrustes.html">pca_rotate_procrustes()</a></code>. We list the names of each variable
we will use in a vector. This implies that the names of the variables are the
same in each dataset. We’ll rotate using just <code>DRESS</code>, <code>TRAP</code>, and <code>KIT</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rot_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"DRESS_F1"</span>, <span class="st">"DRESS_F2"</span>, <span class="st">"TRAP_F1"</span>, <span class="st">"TRAP_F2"</span>, <span class="st">"KIT_F1"</span>, <span class="st">"KIT_F2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">onze_proc</span> <span class="op">&lt;-</span> <span class="va">onze_pca</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/pca_rotate_procrustes.html">pca_rotate_procrustes</a></span><span class="op">(</span></span>
<span>    target <span class="op">=</span> <span class="va">qb_pca</span>, </span>
<span>    max_pcs <span class="op">=</span> <span class="fl">3</span>, <span class="co"># Exercise: look at what happens when you change this. </span></span>
<span>    rotation_variables <span class="op">=</span> <span class="va">rot_vars</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">qb_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"ONZE (Rotated)"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_proc</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    highlight <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">"(DRESS|TRAP|KIT)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">highlight</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">highlight</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-rot-sub"></span>
<img src="Rotation_files/figure-html/fig-rot-sub-1.png" alt="QB1 PCA and Procrustes rotated ONZE PCA, rotated with respect to DRESS, TRAP, and KIT only." width="100%"><p class="caption">
Figure 3.11: QB1 PCA and Procrustes rotated ONZE PCA, rotated with respect to DRESS, TRAP, and KIT only.
</p>
</div>
<p>If you are in the lucky position that you have <em>the exact same speakers</em> in
both corpora, then you can rotate by scores instead and then determine
what happens to the variables. The individuals must be in the same order
in both datasets. This is not the case for the QuakeBox and ONZE corpora, but
it is the case for a subset of the QuakeBox corpora.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1_ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="st">'data/QB1_scores_anon.rds'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">QB2_ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="st">'data/QB2_scores_anon.rds'</span><span class="op">)</span><span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s apply procrustes rotation to the scores and then look at what this does
to the interpretation of the loadings.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get shared speakers between QB1 and QB2 and ensure they are in the same </span></span>
<span><span class="co"># order in the data.</span></span>
<span><span class="va">shared_speakers</span> <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">QB1_ints</span><span class="op">$</span><span class="va">speaker</span>, <span class="va">QB2_ints</span><span class="op">$</span><span class="va">speaker</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB1_ints</span> <span class="op">&lt;-</span> <span class="va">QB1_ints</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">speaker</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">shared_speakers</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">speaker</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB2_ints</span> <span class="op">&lt;-</span> <span class="va">QB2_ints</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">speaker</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">shared_speakers</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">speaker</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB1_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="va">QB1_ints</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>, scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB2_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="va">QB2_ints</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>, scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We apply the rotation to QB2, using the scores from each.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here it would be a good idea to determine how many PCs to include via </span></span>
<span><span class="co"># `pca_test()`. We skip this detail for now.</span></span>
<span><span class="va">QB2_proc</span> <span class="op">&lt;-</span> <span class="va">QB2_pca</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/pca_rotate_procrustes.html">pca_rotate_procrustes</a></span><span class="op">(</span></span>
<span>    target <span class="op">=</span> <span class="va">QB1_pca</span>, </span>
<span>    max_pcs <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    rotate <span class="op">=</span> <span class="st">"scores"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>What does this do to the variance explained by QB2 PCA?</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">QB2_proc</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-proc-var"></span>
<img src="Rotation_files/figure-html/fig-proc-var-1.png" alt="Variance explained by components after Procrustes rotation." width="100%"><p class="caption">
Figure 3.12: Variance explained by components after Procrustes rotation.
</p>
</div>
<p>Let’s look at the loadings.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loadings_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB1"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">QB1_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  <span class="st">"QB2 (Rotated)"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">QB2_proc</span><span class="op">$</span><span class="va">rotation</span>, rownames<span class="op">=</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loadings_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">variable</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Corpus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-qb1-qb2-rot"></span>
<img src="Rotation_files/figure-html/fig-qb1-qb2-rot-1.png" alt="Loadings for first two compnents for QB1 PCA and rotated QB2 PCA." width="100%"><p class="caption">
Figure 3.13: Loadings for first two compnents for QB1 PCA and rotated QB2 PCA.
</p>
</div>
<p>These look very similar to one another. What they say is that if we maximally
align the speakers across the two datasets in a space of variation, the
linguistic interpretation of this variation stays similar.</p>
<p>To repeat: we have here used Procrustes rotation to rotate the scores for
speakers rather than the loadings for variables. We have <em>then</em> looked at the
loadings.</p>
<p>But how much variation is there in the scores after rotation?</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"QB1"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">QB1_pca</span><span class="op">$</span><span class="va">x</span>, rownames<span class="op">=</span><span class="st">"speaker"</span><span class="op">)</span>,</span>
<span>  <span class="st">"QB2 (Rotated)"</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">QB2_proc</span><span class="op">$</span><span class="va">x</span>, rownames<span class="op">=</span><span class="st">"speaker"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"Corpus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">scores_to_plot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      y <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      group <span class="op">=</span> <span class="va">speaker</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Component 1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Component 2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-score-change"></span>
<img src="Rotation_files/figure-html/fig-score-change-1.png" alt="Change in PC scores from QB1 to QB2, after Procrustes rotation." width="100%"><p class="caption">
Figure 3.14: Change in PC scores from QB1 to QB2, after Procrustes rotation.
</p>
</div>
<p>This approach would work <em>even if the two datasets had no variables in common</em>.</p>
</div>
</div>
<div class="section level2" number="4">
<h2 id="rotation-for-single-data-set">
<span class="header-section-number">4</span> Rotation for single data set<a class="anchor" aria-label="anchor" href="#rotation-for-single-data-set"></a>
</h2>
<div class="section level3" number="4.1">
<h3 id="manual-rotation-for-interpretability">
<span class="header-section-number">4.1</span> Manual rotation for interpretability<a class="anchor" aria-label="anchor" href="#manual-rotation-for-interpretability"></a>
</h3>
<p>Sometimes the interpretability of a space generated by PCA would be much easier
if we apply a rotation.</p>
<p>This kind of move is justified if we are more interested in the <em>space</em> captured
by the first <span class="math inline">\(n\)</span> PCs rather than the PCs themselves.</p>
<p>In the example we have just looked at, we can describe X% of variation in the
original data by describing it in terms of a cognitive and a motor dimension.
This is still impressive even when the two dimensions aren’t precisely <em>the PCs</em>.</p>
</div>
<div class="section level3" number="4.2">
<h3 id="procrustes-rotation-for-improved-confidence-bars">
<span class="header-section-number">4.2</span> Procrustes rotation for improved confidence bars<a class="anchor" aria-label="anchor" href="#procrustes-rotation-for-improved-confidence-bars"></a>
</h3>
<p>We can use Procrustes rotation as an alternative source of confidence bars for
loadings. This is currently being explored as an alternative to filtering the
bootstraps so that we get cases where the PCs are more-or-less aligned.</p>
<p>This use of Procrustes rotation as part of bootstrapping is common in
Multidimensional Scaling (MDS).</p>
<p>The fundamental idea is the same as for the case of comparing across two datasets,
for each bootstrap sample is a distinct dataset (explored above).</p>
<p>We implement the test in <code><a href="../reference/procrustes_loadings.html">procrustes_loadings()</a></code> and plot these with
<code><a href="../reference/plot_procrustes_loadings.html">plot_procrustes_loadings()</a></code>. If we decide that this is the better way to go for
generating confidence bands, it will be eventually merged into the <code><a href="../reference/pca_test.html">pca_test()</a></code>
function.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The plan is to carry out a small simulation study on different
strategies for PCA inference with vocalic data.&lt;/p&gt;"><sup>5</sup></a></p>
<p>The <code><a href="../reference/procrustes_loadings.html">procrustes_loadings()</a></code> function takes the data you would usually put in
to <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code> or <code><a href="https://rdrr.io/r/stats/princomp.html" class="external-link">princomp()</a></code>. You have to choose a number of PCs to rotate
(the <code>max_pcs</code> argument). One way to make this choice is to use the output of
<code><a href="../reference/pca_test.html">pca_test()</a></code> (specifically, the number of ‘statistically significant’ PCs,
as determined by looking at the plot of variance explained). We choose 5
PCs, in line with Figure <a href="#fig:fig-onze-var">3.3</a>.</p>
<p>Let’s generate a distribution of <em>signed index loadings</em> for the first 5
PCs, using the <code><a href="../reference/procrustes_loadings.html">procrustes_loadings()</a></code> function on the ONZE data.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/procrustes_loadings.html">procrustes_loadings</a></span><span class="op">(</span></span>
<span>  <span class="va">onze_intercepts_full</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>  max_pcs <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  index <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/procrustes_loadings.html">procrustes_loadings()</a></code> function gives you signed index loadings for each PC
for the bootstrapped analyses (with value <code>Sampling</code> in the <code>source</code> column).</p>
<p>The <code><a href="../reference/plot_procrustes_loadings.html">plot_procrustes_loadings()</a></code> function can then be used to visualise the
distribution.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_procrustes_loadings.html">plot_procrustes_loadings</a></span><span class="op">(</span><span class="va">onze_loadings</span>, pc_no<span class="op">=</span><span class="fl">1</span>, loadings_confint <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-proc-loadings"></span>
<img src="Rotation_files/figure-html/fig-proc-loadings-1.png" alt="Index loadings, confidence band, and null distribution for PC1." width="100%"><p class="caption">
Figure 4.1: Index loadings, confidence band, and null distribution for PC1.
</p>
</div>
<p>By default, the function uses index loadings (as does <code><a href="../reference/pca_test.html">pca_test()</a></code>). But
index loadings are always positive. For the rotation to make sense, we need to
add the sign back to the index loadings (i.e., whether the original loading
is positive or negative). You can generate confidence intervals for the
original loadings by setting <code>index=FALSE</code>.</p>
<p>However, <em>if</em> you set <code>index=FALSE</code>, you will not get an estimate of the null
distribution, and so you won’t get any kind of indication of whether the
loading is itself significant. For instance:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/procrustes_loadings.html">procrustes_loadings</a></span><span class="op">(</span></span>
<span>  <span class="va">onze_intercepts_full</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">speaker</span><span class="op">)</span>,</span>
<span>  max_pcs <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  index <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_procrustes_loadings.html">plot_procrustes_loadings</a></span><span class="op">(</span><span class="va">onze_loadings</span>, pc_no<span class="op">=</span><span class="fl">1</span>, loadings_confint <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rotation_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-brandSystematicCovariationMonophthongs2021" class="csl-entry">
Brand, James, Jen Hay, Lynn Clark, Kevin Watson, and Márton Sóskuthy. 2021. <span>“Systematic Co-Variation of Monophthongs Across Speakers of <span>New Zealand English</span>.”</span> <em>Journal of Phonetics</em> 88: 101096. <a href="https://doi.org/10.1016/j.wocn.2021.101096" class="external-link">https://doi.org/10.1016/j.wocn.2021.101096</a>.
</div>
<div id="ref-hurringHowStableAreUnderreview" class="csl-entry">
Hurring, Gia, Joshua Wilson Black, Jen Hay, and Lynn Clark. Forthcoming. <span>“How Stable Are Patterns of Covariation Across Time?”</span> <em>Language Variation and Change</em>, Forthcoming.
</div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joshua Wilson Black, James Brand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
