<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The Model-to-PCA workflow • nzilbb.vowels</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Model-to-PCA workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nzilbb.vowels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Model-to-PCA-workflow.html">The Model-to-PCA workflow</a></li>
    <li><a class="dropdown-item" href="../articles/Rotation.html">PCA and Rotation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://joshua.wilsonblack.nz/posts/nzilbb-vowels-0-3-1/">nzilbb.vowels 0.3.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nzilbb/nzilbb_vowels/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The Model-to-PCA workflow</h1>
                        <h4 data-toc-skip class="author">Joshua Wilson Black</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nzilbb/nzilbb_vowels/blob/main/vignettes/articles/Model-to-PCA-workflow.Rmd" class="external-link"><code>vignettes/articles/Model-to-PCA-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>Model-to-PCA-workflow.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="overview">
<span class="header-section-number">1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The primary purpose of this package is to aid the ‘model-to-PCA’ pipeline used
in a series of projects at <a href="https://www.canterbury.ac.nz/research/about-uc-research/research-groups-and-centres/new-zealand-institute-of-language-brain-and-behaviour" class="external-link">NZILBB</a> <span class="citation">(Brand et al. 2021; Hurring et al. Forthcoming; Wilson Black, Brand, et al. 2023; Wilson Black, Hay, et al. 2023)</span>.</p>
<p>This article briefly sets out the pipeline and shows how to use the functions
in the package. It was part of a workshop delivered as part of a workshop for
the <a href="https://researchportalplus.anu.edu.au/en/projects/voices-of-regional-australia-the-linguistic-patterning-of-local-a" class="external-link">Voices of Regional Australia</a> project.</p>
<p>We’ll look at a quick introduction to PCA, before applying the workflow to
some data from the <a href="https://quakestudies.canterbury.ac.nz/store/collection/235" class="external-link">UC QuakeBox project</a>.</p>
<div class="section level3" number="1.1">
<h3 id="why-care-about-co-variation">
<span class="header-section-number">1.1</span> Why care about co-variation?<a class="anchor" aria-label="anchor" href="#why-care-about-co-variation"></a>
</h3>
<p>A few reasons:</p>
<ul>
<li><p>Traditionally, sociolinguistic studies focused on analyzing individual sounds
separately, even when considering multiple sounds, except in specific cases like
vowel shifts <span class="citation">(e.g, Gordon 2013; Hay et al. 2015)</span> where there is an expected
relationship between the variables for structural reasons.</p></li>
<li><p>But, work in third-wave sociolinguistics suggests that sounds may function as
interconnected systems e.g. stylistic variation involves combining collections
of variants to convey social meaning <span class="citation">(Becker 2014; Podesva 2007)</span>.</p></li>
<li><p>This has been tricky to investigate empirically and most work in this
paradigm has explored correlations between two variables.</p></li>
<li><p>More recently, we’ve seen a shift towards thinking about clusters of
co-varying variables using methods like Principal Component Analysis (PCA)
<span class="citation">(Brand et al. 2021)</span>.</p></li>
</ul>
</div>
<div class="section level3" number="1.2">
<h3 id="packages">
<span class="header-section-number">1.2</span> Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h3>
<p>We use the following R packages. Comments are provided in the code block below
to indicate their function in the workflow.</p>
<p>Note that there is no special package we use to apply PCA. We use the
function <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>, which is built in to R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="co"># We use functions from most of the 'tidyverse'</span></span>
<span><span class="co"># packages so we tend to load them all at once with library(tidyverse).</span></span>
<span><span class="co"># The best introduction to tidyverse style is "R for Data Science":</span></span>
<span><span class="co"># https://r4ds.hadley.nz/</span></span>
<span></span>
<span><span class="co"># ggrepel provides a version of `geom_label` which</span></span>
<span><span class="co"># automatically repels labels away from other plot</span></span>
<span><span class="co"># items.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span><span class="co"># We use ggcorrplot to generate correlation plots before applying pca.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/wiki/ggcorrplot-visualization-of-a-correlation-matrix-using-ggplot2" class="external-link">ggcorrplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span> <span class="co"># mgcv is required to fit GAMMs.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">itsadug</span><span class="op">)</span> <span class="co"># itsadug is used to extract predictions and random effects</span></span>
<span><span class="co"># from GAMMs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span> <span class="co"># we use `broom` from the `tidymodels` collection to generate</span></span>
<span><span class="co"># dataframes with summary information from our models.</span></span>
<span></span>
<span><span class="co"># `this package`nzilbb.vowels` (not yet released on CRAN) contains functions to</span></span>
<span><span class="co"># perform Lobanov 2.0 normalisation and apply and visualise PCA. Install it from</span></span>
<span><span class="co"># github, with, e.g. remotes::install_github('JoshuaWilsonBlack/nzilbb_vowels').</span></span>
<span><span class="co"># This may require you to install the 'remotes' package.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nzilbb.github.io/nzilbb_vowels/">nzilbb.vowels</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The following line sets the theme for all plots made using the `ggplot2`</span></span>
<span><span class="co"># package (part of the tidyverse).</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="2">
<h2 id="what-is-pca">
<span class="header-section-number">2</span> What is PCA?<a class="anchor" aria-label="anchor" href="#what-is-pca"></a>
</h2>
<p>This section is a shortened version of <span class="citation">Wilson Black, Brand, et al. (2023)</span>.
For further details, see that paper. We especially encourage you to look at the
supplementary material available
<a href="https://nzilbb.github.io/PCA_method_supplementary/PCA_method_supplementary.html" class="external-link">here</a>.</p>
<p>Principal Component Analysis (PCA) is a technique used to simplify complex data
sets that contain many variables. It allows us to replace the many variables
with a much smaller number of Principal Components (PCs) which capture the
majority of the information contained in the original dataset in a convenient
way.</p>
<p>Usually, when we have a lot of variables in a dataset, there are correlations
between variables. Sometimes this is because there is some real underlying
structure in the process which generated the data. For instance, if you look at
lots of body measurements from different people, tall people will tend to have
longer arms <em>and</em> longer legs than short people. This will lead to a correlation
between leg measurements and arm measurements. The resulting pattern in two
variables might be captured by a single PC which tracks overall height. Many
variables, one underlying pattern.</p>
<p>To explain PCA more fully, and with sociophonetic data, let’s consider data from
100 speakers using first formant readings from three vowel sounds:
‘<span class="smallcaps">trap</span>,’ ‘<span class="smallcaps">dress</span>,’ and ‘<span class="smallcaps">kit</span>.’ Changes in
the pronunciation of these vowels over time are linked and so by using this as
example, we can see how PCA finds patterns and we can link those back to our
understanding of the data.</p>
<p>We are going to see how PCA can reduce these three variables down to two
variables. Three variables is not a lot of variables. The advantage of looking
at three variables is that we can visualise the entire process.</p>
<p>The following code generates the data set we need taking data from ONZE, which
comes via the <code>nzilbb.vowels</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `onze_vowels` comes from the `nzilbb_vowels` package.</span></span>
<span><span class="va">onze_sub</span> <span class="op">&lt;-</span> <span class="va">onze_vowels</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">vowel</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRESS"</span>, <span class="st">"KIT"</span>, <span class="st">"TRAP"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">speaker</span>, <span class="va">vowel</span>, <span class="va">F1_50</span>, <span class="va">yob</span>, <span class="va">gender</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># We take means of the first formant data and keep track of each speaker's</span></span>
<span>  <span class="co"># year of birth and gender.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span></span>
<span>    <span class="va">speaker</span>, <span class="va">vowel</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    F1_50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F1_50</span><span class="op">)</span>,</span>
<span>    yob <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">yob</span><span class="op">)</span>,</span>
<span>    gender <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We pivot the dataframe 'wider' so it has a column for each of our three</span></span>
<span><span class="co"># vowel types.</span></span>
<span><span class="va">onze_wide</span> <span class="op">&lt;-</span> <span class="va">onze_sub</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">vowel</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">F1_50</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>What does the data look like at this stage of the process?</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 6</span></span></span>
<span><span class="co">#&gt;    speaker    yob gender DRESS   KIT  TRAP</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> CC_f_020  <span style="text-decoration: underline;">1</span>936 F       623.  647.  638.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> CC_f_084  <span style="text-decoration: underline;">1</span>959 F       551.  622.  669.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CC_f_170  <span style="text-decoration: underline;">1</span>975 F       535.  589.  630.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> CC_f_186  <span style="text-decoration: underline;">1</span>956 F       456.  525.  579.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> CC_f_210  <span style="text-decoration: underline;">1</span>973 F       516.  568.  624.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CC_f_215  <span style="text-decoration: underline;">1</span>950 F       558.  635.  658.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CC_f_245  <span style="text-decoration: underline;">1</span>977 F       605.  664.  662.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CC_f_258  <span style="text-decoration: underline;">1</span>974 F       418.  496.  486.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> CC_f_285  <span style="text-decoration: underline;">1</span>974 F       472.  450.  532.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> CC_f_429  <span style="text-decoration: underline;">1</span>947 F       508.  632.  668.</span></span></code></pre>
<p>We have an anonymous speaker identifier, a year of birth variable, gender, and
a numerical variable for each of <span class="smallcaps">dress</span>, <span class="smallcaps">kit</span>, and
<span class="smallcaps">trap</span>.</p>
<p>Let’s visualise the vowel readings in a scatter plot,
using colour for one of the dimensions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_plot</span> <span class="op">&lt;-</span> <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">DRESS</span>,</span>
<span>      y <span class="op">=</span> <span class="va">TRAP</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">KIT</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"DRESS (Hz)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"TRAP (Hz)"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"KIT (Hz)"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">initial_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-3d"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-3d-1.png" alt="Mean first formant values for three NZE monophthongs." width="100%"><p class="caption">
Figure 2.1: Mean first formant values for three NZE monophthongs.
</p>
</div>
<p>In Figure <a href="#fig:fig-3d">2.1</a>, the most obvious thing to note is that <span class="smallcaps">dress</span> and
<span class="smallcaps">kit</span> are strongly correlated with one another. A second observation
is that the overall colour of the points in the bottom left seems darker than
in the top right. This suggests that <span class="smallcaps">kit</span>’s first formant values
are also correlated with the values for <span class="smallcaps">trap</span> and <span class="smallcaps">kit</span>.</p>
<p>This observation is not surprising. Formant frequencies are associated with
vocal track length. We are here interested in seeing how PCA can capture this
obvious association and, we will see, can also show a more linguistically
interesting pattern in the data.</p>
<p>The code block below applies PCA and extracts some important information
for our initial explanation.
We will explain how to actually apply PCA in detail later.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onze_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="co"># Select the numeric columns of the data</span></span>
<span>  x <span class="op">=</span> <span class="va">onze_wide</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">DRESS</span>, <span class="va">KIT</span>, <span class="va">TRAP</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># NB: this should usually be TRUE.</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">onze_wide</span> <span class="op">&lt;-</span> <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    PC1 <span class="op">=</span> <span class="va">onze_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>    PC2 <span class="op">=</span> <span class="va">onze_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract centre of the point cloud.</span></span>
<span><span class="va">pca_centre</span> <span class="op">&lt;-</span> <span class="va">onze_pca</span><span class="op">$</span><span class="va">center</span></span>
<span></span>
<span><span class="va">centre_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  <span class="st">"DRESS"</span> <span class="op">=</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"DRESS"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="st">"KIT"</span> <span class="op">=</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"KIT"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="st">"TRAP"</span> <span class="op">=</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"TRAP"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract loadings.</span></span>
<span><span class="va">pca_loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">onze_pca</span><span class="op">$</span><span class="va">rotation</span>, rownames <span class="op">=</span> <span class="st">"vowel"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the loadings and centre to find where each point sits along PC1 and PC2</span></span>
<span><span class="co"># when represented in the original 3D space.</span></span>
<span><span class="va">onze_wide</span> <span class="op">&lt;-</span> <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    PC1_DRESS <span class="op">=</span> <span class="op">(</span><span class="va">PC1</span> <span class="op">*</span> <span class="va">pca_loadings</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"PC1"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"DRESS"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    PC1_KIT <span class="op">=</span> <span class="op">(</span><span class="va">PC1</span> <span class="op">*</span> <span class="va">pca_loadings</span><span class="op">[[</span><span class="fl">2</span>, <span class="st">"PC1"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"KIT"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    PC1_TRAP <span class="op">=</span> <span class="op">(</span><span class="va">PC1</span> <span class="op">*</span> <span class="va">pca_loadings</span><span class="op">[[</span><span class="fl">3</span>, <span class="st">"PC1"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"TRAP"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    PC2_DRESS <span class="op">=</span> <span class="op">(</span><span class="va">PC2</span> <span class="op">*</span> <span class="va">pca_loadings</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"PC2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"DRESS"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    PC2_KIT <span class="op">=</span> <span class="op">(</span><span class="va">PC2</span> <span class="op">*</span> <span class="va">pca_loadings</span><span class="op">[[</span><span class="fl">2</span>, <span class="st">"PC2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"KIT"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    PC2_TRAP <span class="op">=</span> <span class="op">(</span><span class="va">PC2</span> <span class="op">*</span> <span class="va">pca_loadings</span><span class="op">[[</span><span class="fl">3</span>, <span class="st">"PC2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">pca_centre</span><span class="op">[[</span><span class="st">"TRAP"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>PCA starts by finding the ‘centre’ of the data. This is just the point at the
mean value of each variable. It can be useful to think of the data as a ‘cloud’
of points. In Figure <a href="#fig:fig-3d">2.1</a> we depict this cloud using both spatial position and
colour.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centre_plot</span> <span class="op">&lt;-</span> <span class="va">initial_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centre_data</span>, size <span class="op">=</span> <span class="fl">15</span>, shape <span class="op">=</span> <span class="fl">4</span>, stroke <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"DRESS (Hz)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"TRAP (Hz)"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"KIT (Hz)"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">centre_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-centre"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-centre-1.png" alt="DRESS, TRAP, and KIT F1 with centre of point cloud indicated." width="100%"><p class="caption">
Figure 2.2: DRESS, TRAP, and KIT F1 with centre of point cloud indicated.
</p>
</div>
<p>Figure <a href="#fig:fig-centre">2.2</a> has a large ‘X’ indicating the centre point, or mean value, for each
variable. It is obviously in the middle of the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axes. If you look at
the shade of blue, with the help of the colour scale, you’ll see that the mean
value of <span class="smallcaps">kit</span> is somewhere around <span class="math inline">\(500%\)</span>.</p>
<p>We now draw a line passing through the centre which ‘maximises variance’. This
is the line which stays in the cloud for the longest. This is the first
principal component (PC). What does it look like in our small example?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This block does some more behind-the-scenes work.</span></span>
<span><span class="va">PC1_projections</span> <span class="op">&lt;-</span>  <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">speaker</span>, <span class="va">PC1_DRESS</span>, <span class="va">PC1_TRAP</span>, <span class="va">PC1_KIT</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    DRESS <span class="op">=</span> <span class="va">PC1_DRESS</span>,</span>
<span>    TRAP <span class="op">=</span> <span class="va">PC1_TRAP</span>,</span>
<span>    KIT <span class="op">=</span> <span class="va">PC1_KIT</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">PC2_projections</span> <span class="op">&lt;-</span>  <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">speaker</span>, <span class="va">PC2_DRESS</span>, <span class="va">PC2_TRAP</span>, <span class="va">PC2_KIT</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    DRESS <span class="op">=</span> <span class="va">PC2_DRESS</span>,</span>
<span>    TRAP <span class="op">=</span> <span class="va">PC2_TRAP</span>,</span>
<span>    KIT <span class="op">=</span> <span class="va">PC2_KIT</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">pc1_plot</span> <span class="op">&lt;-</span> <span class="va">centre_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">DRESS</span>,</span>
<span>      y <span class="op">=</span> <span class="va">TRAP</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">KIT</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    data <span class="op">=</span> <span class="va">PC1_projections</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">pc1_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-PC1"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-PC1-1.png" alt="PC1 on top of centre and points." width="100%"><p class="caption">
Figure 2.3: PC1 on top of centre and points.
</p>
</div>
<p>Figure <a href="#fig:fig-PC1">2.3</a> shows this line. It is clear that it passes through <span class="smallcaps">dress</span>
and <span class="smallcaps">trap</span> the ‘longest’ way. It is harder to see this for
<span class="smallcaps">kit</span>, but spend a few moments convincing yourself that this is
true.</p>
<p>As expected, given what we said above about vocal tract length, this PC
corresponds to overall difference in size. At one end of the line, we see low
values for <span class="smallcaps">dress</span>, <span class="smallcaps">kit</span>, and <span class="smallcaps">trap</span>;
at the other end, we see high values for the same variables.</p>
<p>After drawing the first PC, we draw a second. The second PC also passes through
the centre and maximises variance, but it also has to be at right angles to the
first PC.</p>
<p>We visualise this now (removing the centre point, to make the plot a little more
readable).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pc2_plot</span> <span class="op">&lt;-</span> <span class="va">initial_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">DRESS</span>,</span>
<span>      y <span class="op">=</span> <span class="va">TRAP</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">KIT</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    data <span class="op">=</span> <span class="va">PC1_projections</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">DRESS</span>,</span>
<span>      y <span class="op">=</span> <span class="va">TRAP</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">KIT</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="va">PC2_projections</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">pc2_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-PC2"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-PC2-1.png" alt="PC1 and PC2." width="100%"><p class="caption">
Figure 2.4: PC1 and PC2.
</p>
</div>
<p>The slightly thinner line in Figure <a href="#fig:fig-PC2">2.4</a> represents PC2. If we look at the end of
the line at the bottom left, we see high values for <span class="smallcaps">kit</span>, and lower
values for <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span>. At the other end we see
lower values for <span class="smallcaps">kit</span>, and higher values for <span class="smallcaps">dress</span>
and <span class="smallcaps">trap</span>.</p>
<p>What does this PC mean? Speakers at one end of PC2 have lower (in the vowel
space) realisations of <span class="smallcaps">kit</span> and higher realisations of
<span class="smallcaps">dress</span> and <span class="smallcaps">trap</span>. That is, they are more innovative
with respect to the New Zealand English short front vowel shift. So PC2 is
picking up a linguistically interesting pattern.</p>
<p>A third PC could be drawn at this point, but in practice we never go to as many
PCs as we have original variables.</p>
<p>Often, PCA is used to produce visualisations of complex datasets in two
dimensions. When this is done, we use PC1 and PC2 as the axes on our plot, and
plot each point with respect to their PC <strong>scores</strong>. Scores are the values given
to each speaker for each PC. If a speaker has completely average production,
then they will have PC scores of <span class="math inline">\(0\)</span> for each PC.</p>
<p>What does this look like for the current example?</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind_plot</span> <span class="op">&lt;-</span> <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="co"># WARNING: We scale these values as a rough and ready way to get the</span></span>
<span>      <span class="co"># scores on the same scale as the loadings. The methods we will use in the</span></span>
<span>      <span class="co"># real examples below won't have this problem. The upshot: don't just copy</span></span>
<span>      <span class="co"># the code in this block in a real research project!</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">PC2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"PC1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"PC2"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ind_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-indplot"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-indplot-1.png" alt="Plot of PC1 and PC2 scores for each speaker." width="100%"><p class="caption">
Figure 2.5: Plot of PC1 and PC2 scores for each speaker.
</p>
</div>
<p>There’s one further issue to consider. We know that PC1 captures overall
increase and decrease in formant values, but does a high PC1 score mean the
formant values increase or decrease? When we drew the PC1 and PC2 lines, we
didn’t have to decide on a direction. For instance, in Figure <a href="#fig:fig-PC2">2.4</a>, we
haven’t decided whether PC1 scores <strong>increase</strong> when we move from the centre
point to the left of the plot along the PC1 line or whether they <strong>decrease</strong>.
Either option is fine and which ever PCA function you use in R will make a choice
for you.</p>
<p>One useful way to connect the interpretation of the PCs with the plot of the
scores is to make a ‘biplot’. It’s ‘bi’ in the sense that it plots both the
speakers and the original variables. This is what it looks like in our case:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_plot</span> <span class="op">&lt;-</span> <span class="va">ind_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      y <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">pca_loadings</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      y <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">vowel</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">pca_loadings</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.35</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">bi_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-biplot"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-biplot-1.png" alt="Plot of PC1 and PC2 scores with loadings for each variable." width="100%"><p class="caption">
Figure 2.6: Plot of PC1 and PC2 scores with loadings for each variable.
</p>
</div>
<p>Figure <a href="#fig:fig-biplot">2.6</a> shows the <strong>loadings</strong> of the original variable for PC1
and PC2. It is important to keep the terminology of <strong>scores</strong> and <strong>loadings</strong>
clear in your mind. <strong>Loadings</strong> relate the original variables to the PCs, while
<strong>scores</strong> relate the individual data points, in our case speakers, to the PCs.</p>
<p>How do you read Figure <a href="#fig:fig-biplot">2.6</a>? The arrows show which way the original
variables move as we move around the plot. If we go in the direction of an
arrow, then that variable is increasing in value. So, for instance, if we start
in the centre and move to the right, along PC1, the values for our original
variables increase. That is, a more negative PC1 score means an across the board
decrease in formant values. In the case of PC2, if we go up from the centre,
then <span class="smallcaps">kit</span> increases in value, but <span class="smallcaps">dress</span> and
<span class="smallcaps">trap</span> decrease in value. That is, higher PC2 scores correspond to a
more innovative position in the NZE short front vowel shift.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt; One of the
challenges of PCA in the case of vocalic variables is the number of times you
have to ‘flip’ values from positive to negative. In this case the reasoning is:
higher PC2 score -&amp;gt; higher &lt;span class="smallcaps"&gt;kit&lt;/span&gt; F1 formant value
-&amp;gt; lower realisation of &lt;span class="smallcaps"&gt;kit&lt;/span&gt; in the vowel space. Ignoring backness,
a more innovative position in the NZE short front vowel shift means higher
realisations of &lt;span class="smallcaps"&gt;trap&lt;/span&gt; and &lt;span class="smallcaps"&gt;dress&lt;/span&gt; and lower
realisations of &lt;span class="smallcaps"&gt;kit&lt;/span&gt;.&lt;/p&gt;'><sup>1</sup></a></p>
<p>In Figure <a href="#fig:fig-biplot">2.6</a> we have achieved a representation of speakers in terms of
two variables with a clear linguistic meaning: overall vocal tract length and
position in the NZE short front vowel shift. When we started, in Figure <a href="#fig:fig-3d">2.1</a>,
we had three variables, all of which contained formant values. The great
advantage of PCA is that it we can often achieve this in much more complex data
sets.</p>
<p>One final point is worth highlighting: interpretation is often helped by adding
additional variables to a plot. In this case, we have a <code>yob</code> variable.
Presumably, if our interpretation of PC2 is right, we’d expect speakers born
earlier to be on the conservative side of PC2 (i.e., to have a lower PC2 score).
Let’s see if that’s right:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biplot_sup</span> <span class="op">&lt;-</span> <span class="va">onze_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="co"># WARNING: We scale these values as a rough and ready way to get the</span></span>
<span>      <span class="co"># scores on the same scale as the loadings. The methods we will use in the</span></span>
<span>      <span class="co"># real examples below won't have this problem. The upshot: don't just copy</span></span>
<span>      <span class="co"># the code in this block in a real research project!</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">PC1</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">PC2</span><span class="op">)</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">yob</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      y <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      xend <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      yend <span class="op">=</span> <span class="va">PC2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">pca_loadings</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">PC1</span>,</span>
<span>      y <span class="op">=</span> <span class="va">PC2</span>,</span>
<span>      label <span class="op">=</span> <span class="va">vowel</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">pca_loadings</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.35</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_colour_continuous</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"viridis"</span>, option<span class="op">=</span><span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"PC1"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"PC2"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"Year of birth"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">biplot_sup</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-biplot-sup"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-biplot-sup-1.png" alt="Plot of PC1 and PC2 scores with loadings for each variable. Colour indicates year of birth." width="100%"><p class="caption">
Figure 2.7: Plot of PC1 and PC2 scores with loadings for each variable. Colour indicates year of birth.
</p>
</div>
<p>Figure <a href="#fig:fig-biplot-sup">2.7</a> is exactly what we expect. Low PC2 values correspond to
speakers who were born earlier. The older speakers are the more conservative.
Other questions are raised by the plot (why does the cloud of points taper off
towards the bottom left, for instance?), but we will leave these for your own
reflection.</p>
</div>
<div class="section level2" number="3">
<h2 id="quakebox-monophthongs">
<span class="header-section-number">3</span> Quakebox monophthongs<a class="anchor" aria-label="anchor" href="#quakebox-monophthongs"></a>
</h2>
<p>We now move to an example of real research use of PCA from the QuakeBox corpus.
This section follows in the footsteps of <span class="citation">Hurring et al. (Forthcoming)</span>.</p>
<p>The anonymised data, with stopwords removed,<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The removed stopwords were: ‘a’,
‘ah’, ‘ahh’, ‘am’, ‘an’, ‘and’, ‘are’, “aren’t”, ‘as’, ‘at’, ‘aw’, ‘because’,
‘but’, ‘could’, ‘do’, “don’t”, ‘eh’, ‘for’, ‘from’, ‘gonna’, ‘had’, ‘has’,
‘have’, ‘he’, “he’s”, ‘her’, ‘high’, ‘him’, ‘huh’, ‘i’, “i’ll”, “i’m”, “i’ve”,
“i’d”, ‘in’, ‘into’, ‘is’, ‘it’, “it’s”, ‘its’, ‘just’, ‘mean’, ‘my’, ‘nah’,
‘not’, ‘of’, ‘oh’, ‘on’, ‘or’, ‘our’, ‘says’, ‘she’, “she’s”, ‘should’, ‘so’,
‘than’, ‘that’, “that’s”, ‘the’, ‘them’, ‘there’, “there’s”, ‘they’, ‘this’,
‘to’, ‘uh’, ‘um’, ‘up’, ‘was’, “wasn’t”, ‘we’, ‘were’, ‘what’, ‘when’, ‘which’,
‘who’, ‘with’, ‘would’, ‘yeah’, ‘you’, and “you’ve”. &lt;/p&gt;"><sup>2</sup></a> is available in the
<code>data</code> directory. If you have opened the RStudio project, you should have no
difficulty running the following block.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt; I don’t want to see any use of
&lt;code&gt;&lt;a href="https://rdrr.io/r/base/getwd.html" class="external-link"&gt;setwd()&lt;/a&gt;&lt;/code&gt;! It is poison for reproducibility. We use RStudio projects and the
&lt;code&gt;here&lt;/code&gt; package to avoid this. - JWB &lt;/p&gt;'><sup>3</sup></a></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="st">'data/QB1_anon.rds'</span><span class="op">)</span></span></code></pre></div>
<div class="section level3" number="3.1">
<h3 id="preprocessing-and-filtering">
<span class="header-section-number">3.1</span> Preprocessing and filtering<a class="anchor" aria-label="anchor" href="#preprocessing-and-filtering"></a>
</h3>
<p>The dataframe we have just loaded has already removed words with hesitations,
tokens without transcribed words and unimportant speaker demographics (such as
their household location, occupation, areas lived, etc.). The remainder of this
section shows what additional steps we took to preprocess and filter our data.
You may have other preferences!</p>
<div class="section level4" number="3.1.1">
<h4 id="tidying">
<span class="header-section-number">3.1.1</span> Tidying<a class="anchor" aria-label="anchor" href="#tidying"></a>
</h4>
<p>First of all, let’s change the DISC notation for vowels to Wells Lexical Set labels (we just find this easier to understand when examining the outputs):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      Vowel <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">VowelDISC</span><span class="op">)</span>,</span>
<span>        FLEECE <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>        KIT <span class="op">=</span> <span class="st">"I"</span>,</span>
<span>        DRESS <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>        TRAP <span class="op">=</span> <span class="st">"{"</span>,</span>
<span>        START <span class="op">=</span> <span class="st">"#"</span>,</span>
<span>        LOT <span class="op">=</span> <span class="st">"Q"</span>,</span>
<span>        THOUGHT <span class="op">=</span> <span class="st">"$"</span>,</span>
<span>        NURSE <span class="op">=</span> <span class="st">"3"</span>,</span>
<span>        STRUT <span class="op">=</span> <span class="st">"V"</span>,</span>
<span>        FOOT <span class="op">=</span> <span class="st">"U"</span>,</span>
<span>        GOOSE <span class="op">=</span> <span class="st">"u"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Next, we generate a vowel duration column which we will use for filtering
later.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    VowelEnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">VowelEnd</span><span class="op">)</span>,</span>
<span>    VowelStart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">VowelStart</span><span class="op">)</span>,</span>
<span>    VowelDur <span class="op">=</span> <span class="va">VowelEnd</span> <span class="op">-</span> <span class="va">VowelStart</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We modify the <code>Ethnicity</code> column so that we get a binary distinction between
Māori and non-Māori. The code here is messy, as it is capturing quite a few
different cases. We also change the gender codes from lower case to upper case
(e.g. ‘m’ -&gt; ‘M’) for compatibility with earlier projects.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span><span class="op">[</span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span> <span class="op">==</span> <span class="st">"NZ mixed ethnicity"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Maori"</span></span>
<span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span><span class="op">[</span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span> <span class="op">==</span> <span class="st">"NZ Maori"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Maori"</span></span>
<span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span><span class="op">[</span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span> <span class="op">==</span> <span class="st">"na"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Non-Maori"</span></span>
<span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span><span class="op">[</span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span> <span class="op">==</span> <span class="st">"Other"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Non-Maori"</span></span>
<span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span><span class="op">[</span><span class="va">QB1</span><span class="op">$</span><span class="va">Ethnicity</span> <span class="op">==</span> <span class="st">"NZ European"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Non-Maori"</span></span>
<span></span>
<span></span>
<span><span class="co"># For convenience, we also change gender coding from 'f', 'm' -&gt; 'F', 'M'.</span></span>
<span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Gender <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_upper</a></span><span class="op">(</span><span class="va">Gender</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Finally, we change some character vectors to factors. The only reason we do
this is that it is necessary for the <code>mgcv</code> package, which we use to fit
GAMMs.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># and we make sure that factor variables are coded as factors (rather than character vectors).</span></span>
<span><span class="va">factor_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Gender"</span>, <span class="st">"Ethnicity"</span>, <span class="st">"stress"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">factor_vars</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span>,</span>
<span>    Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.ordered</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4" number="3.1.2">
<h4 id="filtering">
<span class="header-section-number">3.1.2</span> Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h4>
<p>We now remove tokens which are, or are likely to be, errors introduced by forced alignment and formant tracking.</p>
<p>First, we remove tokens:</p>
<ul>
<li>which have infeasibly short or long duration,</li>
<li>have first formant values of 1100 Hz or greater,</li>
<li>missing speaker metadata, and</li>
<li>missing formant values.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">VowelDur</span>, <span class="fl">0.01</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co">#filter tokens with very short or long vowel</span></span>
<span>    <span class="co"># durations (we take values between 0.01 and 2 seconds)</span></span>
<span>    <span class="va">F1_50</span> <span class="op">&lt;</span> <span class="fl">1100</span>, <span class="co"># Remove all tokens with F1 at or above 1100hz.</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Gender</span><span class="op">)</span>, <span class="co">#filter speakers with missing gender</span></span>
<span>    <span class="op">!</span><span class="va">Gender</span> <span class="op">==</span> <span class="st">""</span>,</span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span>, <span class="co"># Filter speakers with missing age.</span></span>
<span>    <span class="va">Age</span> <span class="op">!=</span> <span class="st">'na'</span>, <span class="co"># Filter speakers with missing age.</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">F1_50</span><span class="op">)</span>, <span class="co"># Filter missing formant values.</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">F2_50</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We then remove unstressed tokens and those which precede liquids.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">stress</span> <span class="op">!=</span> <span class="st">"0"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    following_segment_category <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html" class="external-link">fct_collapse</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">following_segment</span><span class="op">)</span>,</span>
<span>      labial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'m'</span>, <span class="st">'p'</span>, <span class="st">'b'</span>, <span class="st">'f'</span>, <span class="st">'w'</span><span class="op">)</span>,</span>
<span>      velar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'k'</span>, <span class="st">'g'</span>, <span class="st">'N'</span><span class="op">)</span>,</span>
<span>      liquid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'r'</span>, <span class="st">'l'</span><span class="op">)</span>,</span>
<span>      other_level <span class="op">=</span> <span class="st">"other"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="va">following_segment_category</span> <span class="op">==</span> <span class="st">'liquid'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We then remove tokens with formant values more than 2.5 sd from their
speaker’s mean. The code below defines a function to apply a standard deviation
filter. This is perhaps slightly more complication that the usual R workflow
in linguistics, but I leave it in so you can see the consequence (if any) of
changing this cut off value.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd_filter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">in_data</span>, <span class="va">sd_limit</span> <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vowels_all_summary</span> <span class="op">&lt;-</span> <span class="va">in_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Remove tokens at +/- sd limit (default 2.5 sd)</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      <span class="co">#calculate the summary statistics required for the outlier removal.</span></span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      mean_F1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F1_50</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      mean_F2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F2_50</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_F1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">F1_50</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_F2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">F2_50</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="co"># Calculate cut off values.</span></span>
<span>      max_F1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F1_50</span><span class="op">)</span> <span class="op">+</span> <span class="va">sd_limit</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">F1_50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      min_F1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F1_50</span><span class="op">)</span> <span class="op">-</span> <span class="va">sd_limit</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">F1_50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      max_F2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F2_50</span><span class="op">)</span> <span class="op">+</span> <span class="va">sd_limit</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">F2_50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      min_F2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">F2_50</span><span class="op">)</span> <span class="op">-</span> <span class="va">sd_limit</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">F2_50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop_last"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#this is the main outlier filtering step.</span></span>
<span>  <span class="va">out_data</span> <span class="op">&lt;-</span> <span class="va">in_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">vowels_all_summary</span>, by<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      outlier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>        <span class="va">F1_50</span> <span class="op">&gt;</span> <span class="va">min_F1</span> <span class="op">&amp;</span></span>
<span>          <span class="va">F1_50</span> <span class="op">&lt;</span> <span class="va">max_F1</span> <span class="op">&amp;</span></span>
<span>          <span class="va">F2_50</span> <span class="op">&gt;</span> <span class="va">min_F2</span> <span class="op">&amp;</span></span>
<span>          <span class="va">F2_50</span> <span class="op">&lt;</span> <span class="va">max_F2</span>,</span>
<span>        <span class="cn">FALSE</span>,</span>
<span>        <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">outlier</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>      <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">outlier</span>, <span class="va">n</span>, <span class="va">mean_F1</span>, <span class="va">mean_F2</span>, <span class="va">sd_F1</span>,</span>
<span>        <span class="va">sd_F2</span>, <span class="va">max_F1</span>, <span class="va">min_F1</span>, <span class="va">max_F2</span>, <span class="va">min_F2</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu">sd_filter</span><span class="op">(</span>sd_limit <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></code></pre></div>
<p>In order to match <span class="citation">Brand et al. (2021)</span>, we
remove <span class="smallcaps">foot</span>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">Vowel</span> <span class="op">!=</span> <span class="st">"FOOT"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Remove FOOT from the factor levels.</span></span>
<span>    Vowel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">Vowel</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The final filtering step, again following
<span class="citation">Brand et al. (2021)</span>, is to remove any speakers who have
fewer than 5 tokens for any of the remaining vowels. We treat this as a minimum
for getting a sensible random intercepts from the speaker. How do we make
this judgement? By looking at the health of the models we fit (including the
distribution of random intercepts).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_speakers</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># .drop is required to capture situations in which a speaker has NO tokens for</span></span>
<span>  <span class="co"># a given vowel. It ensures a group for all levels of the vowel factor</span></span>
<span>  <span class="co"># (including those not present in the data for a given speaker)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span>, .drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Speaker</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Speaker</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">low_speakers</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4" number="3.1.3">
<h4 id="normalisation">
<span class="header-section-number">3.1.3</span> Normalisation<a class="anchor" aria-label="anchor" href="#normalisation"></a>
</h4>
<p>We normalise the vowels using the Lobanov 2.0 method. This is Lobanov
normalisation but with a mean of means approach to handle different token counts
across vowel categories.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt; For further details see
&lt;a href="https://nzilbb.github.io/Covariation_monophthongs_NZE/Covariation_monophthongs_analysis.html#Normalisation" class="external-link"&gt;here&lt;/a&gt;.&lt;/p&gt;'><sup>4</sup></a>
Lobanov 2.0 is implemented in the <code><a href="../reference/lobanov_2.html">lobanov_2()</a></code> function in the <code>nzilbb.vowels</code>
package.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The Lobanov 2.0 function requires that the data be ordered with Speaker id,</span></span>
<span><span class="co"># vowel name, F1 (Hz) and F2 (Hz) as the first four columns.</span></span>
<span></span>
<span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Reorder the data into the column order required by the Lobanov 2 function.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span>, <span class="va">F1_50</span>, <span class="va">F2_50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lobanov_2.html">lobanov_2</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3" number="3.2">
<h3 id="gamm-models">
<span class="header-section-number">3.2</span> GAMM models<a class="anchor" aria-label="anchor" href="#gamm-models"></a>
</h3>
<div class="section level4" number="3.2.1">
<h4 id="why">
<span class="header-section-number">3.2.1</span> Why?<a class="anchor" aria-label="anchor" href="#why"></a>
</h4>
<p>The pipeline we present here can be called the ‘model to PCA’ pipeline. We will
be applying PCA to values extracted from models. To be specific, we apply PCA
to random intercepts extracted from GAMM models. These random intercepts
represent a measure of how far a speakers production of a vowel varies from
what we would expect given the information built into the model.</p>
<p>Why do we do this? Consider PC1 in our toy example of PCA above.
Sociophoneticians are not typically interested in the fact that speakers with
longer vocal tracts produce lower frequency formants. This is a feature of the
voice which we don’t take to be socially meaningful. We get rid of this kind
of variation by means of normalisation. But for different projects, there are
different kinds of variation which we might want to ignore.</p>
<p>We know, for instance, that older speakers will have distinct production from
younger speakers. But, what if, within an age group, some speakers have a more
innovative production than others. To get at this with PCA, we need to control
for the age of our speakers. We do this by including some measure of age in
our models.</p>
<p>Gia Hurring’s PhD thesis (in progress) includes an exploration of the
consequences of these modelling decisions for exploring covariation between
vowels and consonants, so look out for that.</p>
</div>
<div class="section level4" number="3.2.2">
<h4 id="fit">
<span class="header-section-number">3.2.2</span> Fit<a class="anchor" aria-label="anchor" href="#fit"></a>
</h4>
<p>This is not the place to provide an explanation of GAMM modelling. Readers are
directed to <span class="citation">Sóskuthy (2017)</span>.</p>
<p>We fit a distinct GAMM model to each vowel and formant pair i.e., separate models for <span class="smallcaps">dress</span> F1,
<span class="smallcaps">dress</span> F2 etc.</p>
<p>These models predict Lobanov 2.0 normalised formant values with a parametric
term for gender and a four-knot smooth for age category at both levels of gender
(‘M’ and ‘F’). We also fit articulation rate as a control variable and random
effect intercepts for speaker and word.</p>
<p>The pattern in the code block below, of nesting data, fitting models,
and extracting intercepts, is set out in more detail by <span class="citation">Wilson Black (2022)</span>.</p>
<p>Before we begin, we’ll need a numeric representation of the age categories and
to convert speaker, gender, and word to factor variables.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check that age values in the correct order.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">QB1</span><span class="op">$</span><span class="va">Age</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "18-25" "26-35" "36-45" "46-55" "56-65" "66-75" "76-85" "85+"   "na"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correct!</span></span>
<span></span>
<span><span class="co"># Convert to integer and do to factor conversions for speaker and word.</span></span>
<span><span class="va">QB1</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_category_numeric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span>,</span>
<span>    Speaker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Speaker</span><span class="op">)</span>,</span>
<span>    Gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Gender</span><span class="op">)</span>,</span>
<span>    Word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Word</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We count how many speakers are in each category to check whether any age
categories should be excluded:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    speaker_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">Speaker</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   Age   speaker_count</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 18-25            43</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 26-35            19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 36-45            50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 46-55            71</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 56-65            63</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 66-75            36</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 76-85            11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 85+               4</span></span></code></pre>
<p>We’ve only got a few 85+ speakers, so we remove the 85+ category and run the
GAMMs. The code block below does this, but can take quite a long time to run. It
has be set up so that it does not run unless specifically requested (i.e., by
pressing the green ‘run’ button in RStudio).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1_models</span> <span class="op">&lt;-</span> <span class="va">QB1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">Age</span> <span class="op">!=</span> <span class="st">"85+"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="va">F1_50</span>, <span class="op">-</span><span class="va">F2_50</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">F1_lob2</span><span class="op">:</span><span class="va">F2_lob2</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"formant_type"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"formant_value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Vowel</span>, <span class="va">formant_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">data</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span></span>
<span>          <span class="co">#main effects</span></span>
<span>          <span class="va">formant_value</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">age_category_numeric</span>, k <span class="op">=</span> <span class="fl">4</span>, by <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="co"># control vars</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">articulation_rate</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="co"># random effects</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">Speaker</span>, bs<span class="op">=</span><span class="st">'re'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">Word</span>, bs<span class="op">=</span><span class="st">'re'</span><span class="op">)</span>,</span>
<span>          discrete <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          nthreads <span class="op">=</span> <span class="fl">4</span>,</span>
<span>          data <span class="op">=</span> <span class="va">.x</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># save the models to an external file.</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">QB1_models</span>, <span class="fu">here</span><span class="op">(</span><span class="st">'models'</span>, <span class="st">'QB1models.rds'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The above models are very large. You may run out of memory. The main reason the
models are large is that they have a random intercept for each word. If you
remove low frequency words the model will likely fit. This is not a good idea
for an actual research project, but could help you follow this workshop!</p>
<p>At this stage of the process, you should check if your models are any good.
This falls under the general heading of GAMM modelling. The only thing which
you might find difficult is that the models for each vowel are being stored
in a dataframe. So, to access the model for <span class="smallcaps">dress</span> F1, you
could use, e.g.:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dress_f1_model</span> <span class="op">&lt;-</span> <span class="va">QB1_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">Vowel</span> <span class="op">==</span> <span class="st">"DRESS"</span>,</span>
<span>    <span class="va">formant_type</span> <span class="op">==</span> <span class="st">"F1_lob2"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or, in a more 'base R' style:</span></span>
<span><span class="va">dress_f1_model</span> <span class="op">&lt;-</span> <span class="va">QB1_models</span><span class="op">[</span></span>
<span>  <span class="va">QB1_models</span><span class="op">$</span><span class="va">Vowel</span> <span class="op">==</span> <span class="st">"DRESS"</span> <span class="op">&amp;</span> <span class="va">QB1_models</span><span class="op">$</span><span class="va">formant_type</span> <span class="op">==</span> <span class="st">"F1_lob2"</span>,</span>
<span><span class="op">]</span><span class="op">$</span><span class="va">model</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>We won’t dwell on this here, as it falls under the general heading of learning
how to fit GAMMs. If you are interested, have a look at the kind of model tests
we apply <a href="https://nzilbb.github.io/qb_stability_public/markdown/QB-analysis.html#31_GAMMs_on_all_QB1_Speakers" class="external-link">here</a>, <a href="https://nzilbb.github.io/amp_f1_public/supplementary_material/SM4_models.html#23_Generalised_Additive_Mixed_Models" class="external-link">here</a>, and
<a href="https://nzilbb.github.io/Covariation_monophthongs_NZE/Covariation_monophthongs_analysis.html#GAMM_modelling" class="external-link">here</a>.</p>
</div>
<div class="section level4" number="3.2.3">
<h4 id="plot">
<span class="header-section-number">3.2.3</span> Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h4>
<p>While we’re skipping some details of the modelling process, it is absolutely
essential that you look at some plots of the predictions from the model. Here
we extract predictions from each vowel model for all of our age categories and
for both male and female speakers. Here we ignore the question of significance.
If you want to see what it looks like to include only statistically significant
change over time, see <a href="https://nzilbb.github.io/qb_stability_public/markdown/QB-analysis.html#312_Plots" class="external-link">here</a>.</p>
<p>First, we extract the predictions from each model:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">to_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"age_category_numeric"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>, to<span class="op">=</span><span class="fl">7</span>, by<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, <span class="co"># All age categories.</span></span>
<span>  <span class="st">"Gender"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB1_preds</span> <span class="op">&lt;-</span> <span class="va">QB1_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    prediction <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">model</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/get_predictions.html" class="external-link">get_predictions</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">.x</span>, cond <span class="op">=</span> <span class="va">to_predict</span>, print.summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">Vowel</span>, <span class="va">formant_type</span>, <span class="va">prediction</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># This step is important. It ensures that, when we plot,</span></span>
<span>  <span class="co"># arrows go from oldest to youngest speakers.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">age_category_numeric</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">QB1_preds</span> <span class="op">&lt;-</span> <span class="va">QB1_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span> <span class="co"># Remove unneeded variables</span></span>
<span>    <span class="op">-</span><span class="va">articulation_rate</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span> <span class="co"># Pivot</span></span>
<span>    names_from <span class="op">=</span> <span class="va">formant_type</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">CI</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    F1_lob2 <span class="op">=</span> <span class="va">fit_F1_lob2</span>,</span>
<span>    F2_lob2 <span class="op">=</span> <span class="va">fit_F2_lob2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can then plot the predictions we have extracted in the vowel space.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tol colours, designed to be colour blind friendly.</span></span>
<span><span class="va">vowel_colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  DRESS <span class="op">=</span> <span class="st">"#777777"</span>, <span class="co"># This is the 'bad data' colour for maps</span></span>
<span>  FLEECE <span class="op">=</span> <span class="st">"#882E72"</span>,</span>
<span>  GOOSE <span class="op">=</span> <span class="st">"#4EB265"</span>,</span>
<span>  KIT <span class="op">=</span> <span class="st">"#7BAFDE"</span>,</span>
<span>  LOT <span class="op">=</span> <span class="st">"#DC050C"</span>,</span>
<span>  TRAP <span class="op">=</span> <span class="st">"#878100"</span>, <span class="co"># "#F7F056",</span></span>
<span>  START <span class="op">=</span> <span class="st">"#1965B0"</span>,</span>
<span>  STRUT <span class="op">=</span> <span class="st">"#F4A736"</span>,</span>
<span>  THOUGHT <span class="op">=</span> <span class="st">"#72190E"</span>,</span>
<span>  NURSE <span class="op">=</span> <span class="st">"#E8601C"</span>,</span>
<span>  FOOT <span class="op">=</span> <span class="st">"#5289C7"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add labels to data for plotting purposes</span></span>
<span><span class="va">QB1_preds</span> <span class="op">&lt;-</span> <span class="va">QB1_preds</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Vowel</span>, <span class="va">Gender</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      vowel_lab <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>        <span class="va">age_category_numeric</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">age_category_numeric</span><span class="op">)</span>,</span>
<span>        <span class="va">Vowel</span>,</span>
<span>        <span class="st">""</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">QB1_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">F2_lob2</span>,</span>
<span>      y <span class="op">=</span> <span class="va">F1_lob2</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">Vowel</span>,</span>
<span>      label <span class="op">=</span> <span class="va">vowel_lab</span>,</span>
<span>      group <span class="op">=</span> <span class="va">Vowel</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span></span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span></span>
<span>        ends <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>        type<span class="op">=</span><span class="st">"closed"</span>,</span>
<span>        length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="op">!</span><span class="va">vowel_lab</span> <span class="op">==</span> <span class="st">""</span></span>
<span>      <span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span></span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">10</span> <span class="op">/</span> <span class="va">.pt</span>,</span>
<span>    label.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    max.overlaps <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">vowel_colours</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Gender</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"F2 (normalised)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"F1 (normalised)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position<span class="op">=</span><span class="st">"none"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-vowel-change"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-vowel-change-1.png" alt="Change in realisation of monopthongs over apparent time." width="100%"><p class="caption">
Figure 3.1: Change in realisation of monopthongs over apparent time.
</p>
</div>
<p>These patterns have caused us a little bit of head scratching. Now is not the
place to go into it in detail. place to go into it in detail. From here on, the
main thing to know is that the speaker random intercepts in our models provide
us with representations of how far individual speakers deviate from these
patterns (along with variation in articulation rate) and in which direction.</p>
</div>
<div class="section level4" number="3.2.4">
<h4 id="extract-intercepts">
<span class="header-section-number">3.2.4</span> Extract intercepts<a class="anchor" aria-label="anchor" href="#extract-intercepts"></a>
</h4>
<p>The following code block extracts the random intercepts from each model using
the function <code><a href="https://rdrr.io/pkg/itsadug/man/get_random.html" class="external-link">get_random()</a></code> from the <code>itsadug</code> package.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1_intercepts</span> <span class="op">&lt;-</span> <span class="va">QB1_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># for each model we get the speaker random intercepts, rather than the</span></span>
<span>    <span class="co"># word random intercepts.</span></span>
<span>    random_intercepts <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">model</span>,</span>
<span>      <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/get_random.html" class="external-link">get_random</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">$</span><span class="va">`s(Speaker)`</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"Speaker"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">Vowel</span>, <span class="va">formant_type</span>, <span class="va">random_intercepts</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">random_intercepts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Vowel</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">QB1_intercepts</span><span class="op">)</span></span></code></pre></div>
<p>We will use the values now stored in <code>QB1_intercepts</code> as input to a PCA
analysis.</p>
<p>Before we switch to PCA, let’s remove the models from memory as they are take up
a lot of room.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">QB1_models</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3" number="3.3">
<h3 id="pca">
<span class="header-section-number">3.3</span> PCA<a class="anchor" aria-label="anchor" href="#pca"></a>
</h3>
<div class="section level4" number="3.3.1">
<h4 id="applying-pca">
<span class="header-section-number">3.3.1</span> Applying PCA<a class="anchor" aria-label="anchor" href="#applying-pca"></a>
</h4>
<p>There are a few options out there for carrying out PCA. We will use the base
R function <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>, supplemented by the <code><a href="../reference/pca_test.html">pca_test()</a></code> function in the
<code>nzilbb.vowels</code> package.</p>
<p>Both functions require a matrix of numerical variables as input. Each variable
should be a column. In our case, we want each vowel-formant pair, e.g.
<span class="smallcaps">dress</span> F1, <span class="smallcaps">nurse</span> F2, etc, to be a column.</p>
<p>This requires us to pivot our random intercepts form long form to wide form.
This following code block carries this out.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1_intercepts</span> <span class="op">&lt;-</span> <span class="va">QB1_intercepts</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Create a column to store our eventual column names</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Combine the 'vowel' and 'formant_type' columns as a string.</span></span>
<span>    vowel_formant <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="va">Vowel</span>, <span class="st">'_'</span>, <span class="va">formant_type</span><span class="op">)</span>,</span>
<span>    <span class="co"># Remove '_lob2' for cleaner column names</span></span>
<span>    vowel_formant <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">vowel_formant</span>, <span class="st">'_lob2'</span>, <span class="st">''</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Remove old 'vowel' and 'formant_type' columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Vowel</span>, <span class="va">formant_type</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Make data 'wider', by...</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">vowel_formant</span>, <span class="co"># naming columns using 'vowel_formant'...</span></span>
<span>    values_from <span class="op">=</span> <span class="va">intercept</span> <span class="co"># and values from intercept column</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># There's some models with missing values for some speakers. We insist on</span></span>
<span><span class="co"># a value for each variable.</span></span>
<span><span class="va">QB1_intercepts</span> <span class="op">&lt;-</span> <span class="va">QB1_intercepts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">QB1_intercepts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">QB1_intercepts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 21</span></span></span>
<span><span class="co">#&gt;   Speaker     DRESS_F1 DRESS_F2 FLEECE_F1 FLEECE_F2 GOOSE_F1 GOOSE_F2  KIT_F1</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> QB_NZ_F_103  -<span style="color: #BB0000;">0.097</span><span style="color: #BB0000; text-decoration: underline;">6</span> -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">90</span>    0.226    -<span style="color: #BB0000;">0.171</span>   0.021<span style="text-decoration: underline;">3</span>   0.081<span style="text-decoration: underline;">5</span>   0.209 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> QB_NZ_F_107  -<span style="color: #BB0000;">0.142</span>  -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">06</span>   -<span style="color: #BB0000;">0.090</span><span style="color: #BB0000; text-decoration: underline;">4</span>    0.013<span style="text-decoration: underline;">6</span>  0.096<span style="text-decoration: underline;">9</span>   0.098<span style="text-decoration: underline;">7</span>  -<span style="color: #BB0000;">0.013</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> QB_NZ_F_121  -<span style="color: #BB0000;">0.053</span><span style="color: #BB0000; text-decoration: underline;">7</span>  0.127      0.071<span style="text-decoration: underline;">7</span>    0.019<span style="text-decoration: underline;">8</span> -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">00</span> -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">83</span>  0.067<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> QB_NZ_F_131  -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">1</span>  0.038<span style="text-decoration: underline;">2</span>     0.112    -<span style="color: #BB0000;">0.056</span><span style="color: #BB0000; text-decoration: underline;">3</span>  0.022<span style="text-decoration: underline;">8</span>  -<span style="color: #BB0000;">0.088</span><span style="color: #BB0000; text-decoration: underline;">4</span>   0.395 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> QB_NZ_F_132   0.101  -<span style="color: #BB0000;">0.074</span><span style="color: #BB0000; text-decoration: underline;">0</span>    -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">0</span>    0.147  -<span style="color: #BB0000;">0.049</span><span style="color: #BB0000; text-decoration: underline;">0</span>   0.042<span style="text-decoration: underline;">7</span>  -<span style="color: #BB0000;">0.078</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> QB_NZ_F_133  -<span style="color: #BB0000;">0.011</span><span style="color: #BB0000; text-decoration: underline;">1</span>  0.052<span style="text-decoration: underline;">9</span>    -<span style="color: #BB0000;">0.136</span>     0.129   0.065<span style="text-decoration: underline;">9</span>  -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">8</span>   0.066<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more variables: KIT_F2 &lt;dbl&gt;, LOT_F1 &lt;dbl&gt;, LOT_F2 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   NURSE_F1 &lt;dbl&gt;, NURSE_F2 &lt;dbl&gt;, START_F1 &lt;dbl&gt;, START_F2 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   STRUT_F1 &lt;dbl&gt;, STRUT_F2 &lt;dbl&gt;, THOUGHT_F1 &lt;dbl&gt;, THOUGHT_F2 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   TRAP_F1 &lt;dbl&gt;, TRAP_F2 &lt;dbl&gt;</span></span></span></code></pre>
<p>I like to leave the <code>Speaker</code> column in the dataframe, even though it has to be
removed each time I run PCA. It helps me to remain confident that the values
correspond to specific speakers.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This is why &lt;code&gt;|&amp;gt; select(-Speaker)&lt;/code&gt; appears
frequently in the code blocks below. This code fragment removes the speaker
column.&lt;/p&gt;"><sup>5</sup></a></p>
<p>It’s worth doing a quick sanity check before actually applying PCA. PCA finds
patterns of covariation in data. If there are any such patterns, then there
should be some pairwise correlations between our variables. We can look at this
visually with a correlation plot.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QB1_intercepts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Speaker</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcorrplot/man/ggcorrplot.html" class="external-link">ggcorrplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:qb1-pairwise"></span>
<img src="Model-to-PCA-workflow_files/figure-html/qb1-pairwise-1.png" alt="Pairwise correlations between extracted random intercepts." width="100%"><p class="caption">
Figure 3.2: Pairwise correlations between extracted random intercepts.
</p>
</div>
<p>A pattern of various colours, in reasonably deep blue or red is good news at
this point of the process.</p>
<p>We test whether the number and magnitude of correlations is significantly
different from what we would see with random data. For instance, by producing
the following plots using the <code><a href="../reference/plot_correlation_magnitudes.html">plot_correlation_magnitudes()</a></code> and
<code><a href="../reference/plot_correlation_counts.html">plot_correlation_counts()</a></code> functions in <code>nzilbb.vowels</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cor_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correlation_test.html">correlation_test</a></span><span class="op">(</span></span>
<span>  <span class="va">QB1_intercepts</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Speaker</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="st">"pearson"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_correlation_magnitudes.html">plot_correlation_magnitudes</a></span><span class="op">(</span><span class="va">cor_test</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/plot_correlation_counts.html">plot_correlation_counts</a></span><span class="op">(</span><span class="va">cor_test</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-qb1-cortests"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-qb1-cortests-1.png" alt="Correlation tests applied to the byu-speaker intercepts derived from the QuakeBox models. (A) shows the distribution of correlation magnitudes in the permuted data (teal), and the actual data (red). (B) shows the counts of statistically significant correlations ($lpha$ = 0.05) in the permuted data (teal) and the actual data (red)." width="100%"><p class="caption">
Figure 3.3: Correlation tests applied to the byu-speaker intercepts derived from the QuakeBox models. (A) shows the distribution of correlation magnitudes in the permuted data (teal), and the actual data (red). (B) shows the counts of statistically significant correlations (<span class="math inline">\(lpha\)</span> = 0.05) in the permuted data (teal) and the actual data (red).
</p>
</div>
<p>Figure <a href="#fig:fig-qb1-cortests">3.3</a> shows that there are many more high magnitude correlations in our
dataset than in random data (panel A) and that the count of statistically
significant pairwise correlations (<span class="math inline">\(\alpha\)</span> = 0.05) is much higher than found in
random data (panel B).</p>
<p>Let’s finally apply PCA using the <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code> function. It is almost always a
good idea to set <code>scale = TRUE</code>. The default value is only <code>FALSE</code> for
consistency with an earlier programming language (‘S’). Different vowels,
even when normalised, have different variances. If you don’t scale, the
variables with the most variance will dominate even if they don’t appear in any
interesting patterns of covariation.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span></span>
<span>  <span class="co"># We use the intercepts without the speaker column.</span></span>
<span>  <span class="va">QB1_intercepts</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Speaker</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>What does <code>qb_pca</code> contain, now? Have a look in the RStudio viewer. The key
things to note are <code>qb_pca$x</code>, which contains the speaker <strong>scores</strong>, and
<code>qb_pca$rotation</code>, which contains the <strong>loadings</strong>. We also have <code>qb_pca$sdev</code>
which captures how much variation each PC captures and is used to determine
how many PCs we want to use.</p>
<p>Let’s look at the <code>qb_pca$rotation</code> briefly, looking at the loadings for PC1
only.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="st">"PC1"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    DRESS_F1    DRESS_F2   FLEECE_F1   FLEECE_F2    GOOSE_F1    GOOSE_F2 </span></span>
<span><span class="co">#&gt;  0.30189388 -0.20305569 -0.32250732  0.32900513 -0.27718563  0.09453797 </span></span>
<span><span class="co">#&gt;      KIT_F1      KIT_F2      LOT_F1      LOT_F2    NURSE_F1    NURSE_F2 </span></span>
<span><span class="co">#&gt; -0.26712816  0.29556390  0.01724038  0.03805744  0.29210571 -0.26058661 </span></span>
<span><span class="co">#&gt;    START_F1    START_F2    STRUT_F1    STRUT_F2  THOUGHT_F1  THOUGHT_F2 </span></span>
<span><span class="co">#&gt; -0.11924109 -0.13465252 -0.17660130 -0.06213031  0.12018776  0.09017500 </span></span>
<span><span class="co">#&gt;     TRAP_F1     TRAP_F2 </span></span>
<span><span class="co">#&gt;  0.31817510 -0.25436522</span></span></code></pre>
<p>Lots of patterns are visible in this output. For instance, the pattern in our
toy example above is here. See that <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span>
F1 are loaded positively, while <span class="smallcaps">kit</span> F1 has a negative loading.
This gives some initial indication that the short front vowel shift is being
captured by this PC and perhaps connected with other patterns of covariation.
This is explored in detail by <span class="citation">Hurring et al. (Forthcoming)</span>.</p>
</div>
<div class="section level4" number="3.3.2">
<h4 id="how-many-pcs">
<span class="header-section-number">3.3.2</span> How many PCs?<a class="anchor" aria-label="anchor" href="#how-many-pcs"></a>
</h4>
<p>We have to select a small number of PCs to keep. We are trying to reduce the
dimensionality of our original data. We want fewer variables to work with. PCA
produces as many PCs as there are variables in the original data, but, when
things are working well, most of the information in the data set will be
captured in the first few PCs.</p>
<p>We determine how many PCs to keep by looking at how much variance each PC
explains. A useful way to think of this is in terms of the percentage of
variation explained by each PC. We can turn <code>pca$sdev</code> to a proportion of
variance explained and plot it as follows:<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;
In the interest of simplicity, we’re avoiding adding a lot of packages here.
We have found the plotting functions in the &lt;code&gt;factoextra&lt;/code&gt; package useful. In
the case of the , &lt;code&gt;fviz_screeplot()&lt;/code&gt; would do the job of the block below.&lt;/p&gt;"><sup>6</sup></a></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variance_explained</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span></span>
<span>  <span class="va">qb_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qb_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>  rownames <span class="op">=</span> <span class="st">"PC"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This bit of code turns the column with PC labels into a factor in the correct</span></span>
<span><span class="co"># order, otherwise we get PC1, PC10, PC11, ... PC2...; rather than PC1, PC2,</span></span>
<span><span class="co"># PC3... (i.e. alphabetical order rather than numerical)</span></span>
<span><span class="va">variance_explained</span> <span class="op">&lt;-</span> <span class="va">variance_explained</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    PC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="va">PC</span><span class="op">)</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">variance_explained</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">variance_explained</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># We'll just take the first 10 PCs.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">PC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">PC</span>,</span>
<span>      y <span class="op">=</span> <span class="va">value</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Variance explained (%)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-screeplot"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-screeplot-1.png" alt="Screeplot of the percentage of variance explained by the first ten PCs." width="100%"><p class="caption">
Figure 3.4: Screeplot of the percentage of variance explained by the first ten PCs.
</p>
</div>
<p>Figure <a href="#fig:fig-screeplot">3.4</a> is an example of a “screeplot”. Various methods are out there for
determining how many PCs to take here. Almost all of them amount to rules of
thumb, and those which are more deterministic are not necessarily appropriate.
There’s no way to avoid applying judgement here!</p>
<p>One of the most common ways to use screeplots is to decide on an ‘elbow’ in the
plot. Where does the plot cease to be steep? We could make an argument for
including PC1 only, or perhaps PC1 and PC2 on this basis.</p>
<p>Our response to this has been to adopt permutation and bootstrapping approaches
of the sort discussed in <span class="citation">(Vieira 2012)</span> and implemented
also in the <code>PCAtest</code> package <span class="citation">(Camargo 2022)</span>. This
gives us a way to decide how much variance we would expect to be explained by
a given PC given the absence of patterns in the data.</p>
<p>Our approach uses the <code><a href="../reference/pca_test.html">pca_test()</a></code> function in the <code>nzilbb.vowels</code> package. We
apply this as follows:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_pca_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_test.html">pca_test</a></span><span class="op">(</span></span>
<span>  <span class="va">QB1_intercepts</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Speaker</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">100</span> <span class="co"># The number of permutations to try. I'd go up to 500 for anything</span></span>
<span>  <span class="co"># you publish, but leaving it at a lower number is better when experimenting.</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then plot our variant of the screeplot with the
<code><a href="../reference/plot_variance_explained.html">plot_variance_explained()</a></code> function.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_variance_explained.html">plot_variance_explained</a></span><span class="op">(</span><span class="va">qb_pca_test</span>, pc_max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-screeplot-2"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-screeplot-2-1.png" alt="Screeplot with error bars." width="100%"><p class="caption">
Figure 3.5: Screeplot with error bars.
</p>
</div>
<p>Figure <a href="#fig:fig-screeplot-2">3.5</a> introduces two changes to what we saw in Figure <a href="#fig:fig-screeplot">3.4</a>. First,
the red bars are estimated confidence intervals for the variance explained. They
are estimated by bootstrapping. That is, by repeating the analysis over and over
again while excluding different portions of the data. Second, the blue bars
indicate the same distribution for data in which we have randomly shuffled each
column.</p>
<p>We argue that all PCs in which the red point appears above the blue bar should
be explicitly mentioned <em>somewhere</em>. However, often the PCs which are very close
to the blue bar are uninteresting and so can be rejected. This will usually only
require a sentence or two, and might only appear in supplementary
materials. We’ll see what this looks like in a moment.</p>
<p>The second thing to note is scenarios in which two or more red bars overlap.
This happens for PC3 and PC4 in the plot above. In any situation when two PCs
explain the same amount of variance, PC loadings can become unstable. We
will discuss ways to deal with this later in the workshop.</p>
<div class="section level5" collapse="true" number="3.3.2.1">
<h5 id="more-details-about-stability">
<span class="header-section-number">3.3.2.1</span> More details about ‘stability’<a class="anchor" aria-label="anchor" href="#more-details-about-stability"></a>
</h5>
<p>There are actually two issues we’re dealing with when thinking about the red
points and bars:</p>
<ol style="list-style-type: decimal">
<li><p>Is one PC reliably distinct from the next PC? This is true if the red
<strong>point</strong> of PC<span class="math inline">\(n\)</span> falls outside of the red bars of PC<span class="math inline">\(n+1\)</span>.</p></li>
<li><p>Are the confidence intervals which we put on the loadings in the next section
stable? This is true if the bars of PC<span class="math inline">\(n\)</span> do not overlap the bars for PC<span class="math inline">\(n+1\)</span>.</p></li>
</ol>
</div>
</div>
<div class="section level4" number="3.3.3">
<h4 id="interpreting-pcs">
<span class="header-section-number">3.3.3</span> Interpreting PCs<a class="anchor" aria-label="anchor" href="#interpreting-pcs"></a>
</h4>
<p>As already noted, we interpret PCs by looking at the loadings. Just as in the
previous section, we’ll look at a standard way of looking at PC loadings and
then introduce our preferred way (which again, uses <code><a href="../reference/pca_test.html">pca_test()</a></code>).</p>
<p>With the output of <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>, we can use the <code><a href="../reference/pca_contrib_plot.html">pca_contrib_plot()</a></code> function from
<code>nzilbb.vowels</code>. These plots were used in BRANDETAL.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;
This function plots the loadings, extracted from &lt;code&gt;qb_pca$rotation&lt;/code&gt;, converted
to ‘contributions’, i.e., percentage of the PC’s variance explained by the
original variable. The conversion is just to square the loading and multiply by
&lt;span class="math inline"&gt;\(100\)&lt;/span&gt;.&lt;/p&gt;'><sup>7</sup></a></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pca_contrib_plot.html">pca_contrib_plot</a></span><span class="op">(</span><span class="va">qb_pca</span>, pc_no <span class="op">=</span> <span class="fl">1</span>, cutoff <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="fu"><a href="../reference/pca_contrib_plot.html">pca_contrib_plot</a></span><span class="op">(</span><span class="va">qb_pca</span>, pc_no <span class="op">=</span> <span class="fl">1</span>, cutoff <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-contrib-nocut"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-contrib-nocut-1.png" alt="PC1 loadings with and without 50% cutoff." width="100%"><p class="caption">
Figure 3.6: PC1 loadings with and without 50% cutoff.
</p>
</div>
<p>Figure <a href="#fig:fig-contrib-nocut">3.6</a> shows the loadings for PC1 with and without a cutoff value at
50%. If we accept a 50% cutoff, then we only interpret the variables on the
right hand side of the red line. This number should be chosen in advance. Some
researchers instead use the ‘elbow rule’ again here. In which case, they would
likely choose the variables from <span class="smallcaps">trap</span> F2 and to the right.</p>
<p>Again, we are in an area where there is no one right answer. In this case, I’d
argue against the 50% rule, because there is no clear rationale for drawing the
line between <span class="smallcaps">goose</span> F1 and <span class="smallcaps">nurse</span> F1. The movement in,
to repeat the same example again, <span class="smallcaps">kit</span> F1, seems plausibly
associated with the variables to the right of the red line.</p>
<p>We now prefer to use the <code><a href="../reference/plot_loadings.html">plot_loadings()</a></code> function from <code>nzilbb.vowels</code>, which
adds confidence bars to ‘index loadings’. Index loadings are the loadings
multiplied by the amount of variance explained by each PC. This is the approach
encouraged by <span class="citation">Vieira (2012)</span>. It penalises loadings in
weaker PCs, which can often represent noise in the data.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_loadings.html">plot_loadings</a></span><span class="op">(</span><span class="va">qb_pca_test</span>, pc_no <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-pc1-loadings"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-pc1-loadings-1.png" alt="Index loadings for PC1." width="100%"><p class="caption">
Figure 3.7: Index loadings for PC1.
</p>
</div>
<p>When we look at Figure <a href="#fig:fig-pc1-loadings">3.7</a>, we see black indications of the loading and
its direction. In this case, when PC1 increases, <span class="smallcaps">fleece</span> F2
increases (because its loading has a ‘plus’ sign) and <span class="smallcaps">fleece</span> F1
decreases (because its loading has a ‘negative’ sign).</p>
<p>If an index loading appear above the blue bars, it is larger than would be
expected for data with no structure. There is a clear rule for the blue bars:
ignore variables whose loadings appear below the blue bars.</p>
<p>When we turn to the red bars, we are back into the realm of rules of thumb and
judgement. The red bars then indicate 95% of the range
of the index loadings for that variable in our bootstrapped samples. We treat
these as indicative of how stable the <em>covariation</em> between variables is. If the
lower limit of a red bar gets near zero, then we have reason to think the
corresponding variable only happens to be correlated with the others in this
dataset. When using PCA in an exploratory spirit or to generate hypotheses, any
variable with a red bar starting near zero should be excluded from any claimed
patterns of covariation. This is an area where we need to do more work to
explore the consequences of alternative rules for including variables.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;In Figure &lt;a href="#fig:fig-pc1-loadings"&gt;3.7&lt;/a&gt;, we might be tempted to exclude all variables whose red
bars overlap with the blue. In many cases, we have found this rule to be too
conservative.&lt;/p&gt;'><sup>8</sup></a></p>
<p>To repeat, because this can be unclear: we take plots like Figure <a href="#fig:fig-pc1-loadings">3.7</a>
to give clear advice about which variables should definitely be <strong>excluded</strong>,
but no definite advice about which variables should be included.</p>
<p>So what does Figure <a href="#fig:fig-pc1-loadings">3.7</a> <em>mean</em>? We can read the relationships off the
loadings. This, as mentioned above, takes a few mental steps, especially when
moving from loading plots to the vowel space. We have started using the
<code><a href="../reference/plot_pc_vs.html">plot_pc_vs()</a></code> function to quickly plot loadings in the vowel space. This
takes some of the mental load off.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pc1_vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_pc_vs.html">plot_pc_vs</a></span><span class="op">(</span></span>
<span>  <span class="va">QB1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span>, <span class="va">F1_lob2</span>, <span class="va">F2_lob2</span><span class="op">)</span>,</span>
<span>  <span class="va">qb_pca_test</span>,</span>
<span>  pc_no <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pc1_vs</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-pc1-vs"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-pc1-vs-1.png" alt="PC1 loadings represented in vowel space. As PC1 scores increase, a speakers vowels tend to move in the direction of the arrows." width="100%"><p class="caption">
Figure 3.8: PC1 loadings represented in vowel space. As PC1 scores increase, a speakers vowels tend to move in the direction of the arrows.
</p>
</div>
<p>The overall impression in Figure <a href="#fig:fig-pc1-vs">3.8</a> is that higher values of PC1 lead to more
canonically ‘conservative’ realisations of NZE vowels. This includes
<span class="smallcaps">fleece</span>, <span class="smallcaps">goose</span>, <span class="smallcaps">nurse</span> and other vowels
not typically included in the short front vowel shift.</p>
<p>If you can’t see the arrows in the plot on your device, change the size of the
plot. In RStudio, you can press the ‘show in new window’ button which appears
at the top right of the plot in the output of a code chunck.</p>
<p>Sometimes, it will be easier for interpretation if the direction of a PC is
changed. In this case, we might want to have positive PC values indicate an
innovative rather than conservative speaker. The <code>nzilbb.vowels</code> package has
the function <code><a href="../reference/pc_flip.html">pc_flip()</a></code> for this purpose. It works on the output of <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp()</a></code>
and of <code><a href="../reference/pca_test.html">pca_test()</a></code>. Let’s flip PC1 for the two PCA objects we currently have.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qb_pca_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pc_flip.html">pc_flip</a></span><span class="op">(</span><span class="va">qb_pca_test</span>, pc_no <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">qb_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pc_flip.html">pc_flip</a></span><span class="op">(</span><span class="va">qb_pca</span>, pc_no <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Now we repeat Figure <a href="#fig:fig-pc1-vs">3.8</a>, and see that the loadings have reversed.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pc1_vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_pc_vs.html">plot_pc_vs</a></span><span class="op">(</span></span>
<span>  <span class="co"># We need the original vocalic data to find the mean values of each vowel.</span></span>
<span>  <span class="co"># The function assumes the data's first four columns are speaker id, vowel id,</span></span>
<span>  <span class="co"># F1, and F2. In this case, we want normalised values, so we use `relocate()`</span></span>
<span>  <span class="co"># to ensure that they are in the third and fourth column (rather than raw</span></span>
<span>  <span class="co"># values).</span></span>
<span>  <span class="va">QB1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span>, <span class="va">F1_lob2</span>, <span class="va">F2_lob2</span><span class="op">)</span>,</span>
<span>  <span class="va">qb_pca_test</span>,</span>
<span>  pc_no <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  is_sig <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># This option is only available when plotting pca_test() results.</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pc1_vs</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-pc1-vs-flipped"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-pc1-vs-flipped-1.png" alt="PC1 loadings represented in vowel space. As PC1 scores increase, a speakers vowels tend to move in the direction of the arrows. Flipped from previous figure." width="100%"><p class="caption">
Figure 3.9: PC1 loadings represented in vowel space. As PC1 scores increase, a speakers vowels tend to move in the direction of the arrows. Flipped from previous figure.
</p>
</div>
<p>What about PC2?</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_loadings.html">plot_loadings</a></span><span class="op">(</span><span class="va">qb_pca_test</span>, pc_no <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-pc2-loadings"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-pc2-loadings-1.png" alt="Index loadings for PC2." width="100%"><p class="caption">
Figure 3.10: Index loadings for PC2.
</p>
</div>
<p>Here we have four clearly covarying variables: <span class="smallcaps">strut</span>,
<span class="smallcaps">thought</span> and <span class="smallcaps">start</span> F2, and <span class="smallcaps">thought</span> F1.
We were very happy to see this pattern, which also appears in the ONZE corpus
<span class="citation">(Brand et al. 2021)</span>. It is open to us to include or
exclude <span class="smallcaps">lot</span> F2.</p>
<p>What does this look like in the vowel space?</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pc2_vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_pc_vs.html">plot_pc_vs</a></span><span class="op">(</span></span>
<span>  <span class="va">QB1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">Speaker</span>, <span class="va">Vowel</span>, <span class="va">F1_lob2</span>, <span class="va">F2_lob2</span><span class="op">)</span>,</span>
<span>  <span class="va">qb_pca_test</span>,</span>
<span>  pc_no <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  is_sig <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pc2_vs</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:fig-pc2-vs"></span>
<img src="Model-to-PCA-workflow_files/figure-html/fig-pc2-vs-1.png" alt="PC2 loadings represented in vowel space." width="100%"><p class="caption">
Figure 3.11: PC2 loadings represented in vowel space.
</p>
</div>
<p>As in <span class="citation">(Brand et al. 2021)</span>, Figure <a href="#fig:fig-pc2-vs">3.11</a> shows a pattern
where the back vowels can be more or less linear, with <span class="smallcaps">thought</span>
fronting while <span class="smallcaps">lot</span> and <span class="smallcaps">strut</span> back, or vice versa.</p>
<p>The feature of this PCA which most excited us was the close match between QB1
PCs and the PCs derived from ONZE. Patterns discernible over the long time
depth of ONZE are also present in a much more recent data collection.</p>
</div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="final-words-and-future-directions">
<span class="header-section-number">4</span> Final words and future directions<a class="anchor" aria-label="anchor" href="#final-words-and-future-directions"></a>
</h2>
<p>Some explanations of PCA within linguistics take a different tack from what we
have presented above. For instance,
<span class="citation">Desagulier (2020)</span> presents PCA as one amongst a
number of exploratory methods which can be used to draw conclusions ’for the
corpus only (438). Exploratory use of PCA does not provide a strong test of
the patterns which we pick out. But we <em>can</em> make predictions about what PCA
will show in another data set (as in <span class="citation">Hurring et al. (Forthcoming)</span>). We can
also use bootstrapping methods (as in <code><a href="../reference/pca_test.html">pca_test()</a></code>) to help mitigate against any
idiosyncratic features of our corpus.</p>
<p>In future work, we’ll look at the use of bootstrapped confidence intervals and
index loadings when compared with a rotation-based method. Some work towards
this was presented at Methods in Dialectology last year <span class="citation">(Sheard and Wilson Black 2024)</span>.</p>
<p>It is also important to note the existence of Functional Principal Component
Analysis. Another stream of research at NZILBB has been working with this method
recently. One possible way in is <span class="citation">Gubian, Torreira, and Boves (2015)</span>.</p>
<div class="refs">

</div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-rmarkdown2024" class="csl-entry">
Allaire, JJ, Yihui Xie, Christophe Dervieux, Jonathan McPherson, Javier Luraschi, Kevin Ushey, Aron Atkins, et al. 2024. <em><span class="nocase">rmarkdown</span>: Dynamic Documents for r</em>. <a href="https://github.com/rstudio/rmarkdown" class="external-link">https://github.com/rstudio/rmarkdown</a>.
</div>
<div id="ref-beckerLinguisticRepertoireEthnic2014" class="csl-entry">
Becker, Kara. 2014. <span>“Linguistic Repertoire and Ethnic Identity in <span>New York City</span>.”</span> <em>Language &amp; Communication</em>, New perspectives on linguistic variation and ethnic identity in <span>North America</span>, 35 (March): 43–54. <a href="https://doi.org/10.1016/j.langcom.2013.12.007" class="external-link">https://doi.org/10.1016/j.langcom.2013.12.007</a>.
</div>
<div id="ref-brandSystematicCovariationMonophthongs2021" class="csl-entry">
Brand, James, Jen Hay, Lynn Clark, Kevin Watson, and Márton Sóskuthy. 2021. <span>“Systematic Co-Variation of Monophthongs Across Speakers of <span>New Zealand English</span>.”</span> <em>Journal of Phonetics</em> 88: 101096. <a href="https://doi.org/10.1016/j.wocn.2021.101096" class="external-link">https://doi.org/10.1016/j.wocn.2021.101096</a>.
</div>
<div id="ref-camargoPCAtestTestingStatistical2022" class="csl-entry">
Camargo, Arley. 2022. <span>“<span>PCAtest</span>: Testing the Statistical Significance of <span>Principal Component Analysis</span> in <span>R</span>.”</span> <em>PeerJ</em> 10: e12967. <a href="https://doi.org/10.7717/peerj.12967" class="external-link">https://doi.org/10.7717/peerj.12967</a>.
</div>
<div id="ref-desagulierMultivariateExploratoryApproaches2020" class="csl-entry">
Desagulier, Guillaume. 2020. <span>“Multivariate <span>Exploratory Approaches</span>.”</span> In <em>A <span>Practical Handbook</span> of <span>Corpus Linguistics</span></em>, edited by Magali Paquot and Stefan Th. Gries, 435–69. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-030-46216-1_19" class="external-link">https://doi.org/10.1007/978-3-030-46216-1_19</a>.
</div>
<div id="ref-rsample" class="csl-entry">
Frick, Hannah, Fanny Chow, Max Kuhn, Michael Mahoney, Julia Silge, and Hadley Wickham. 2025. <em><span class="nocase">rsample</span>: General Resampling Infrastructure</em>. <a href="https://CRAN.R-project.org/package=rsample" class="external-link">https://CRAN.R-project.org/package=rsample</a>.
</div>
<div id="ref-gordonInvestigatingChainShifts2013" class="csl-entry">
Gordon, Matthew J. 2013. <span>“Investigating <span>Chain Shifts</span> and <span>Mergers</span>.”</span> In <em>The <span>Handbook</span> of <span>Language Variation</span> and <span>Change</span></em>, 203–19. John Wiley &amp; Sons, Ltd. <a href="https://doi.org/10.1002/9781118335598.ch9" class="external-link">https://doi.org/10.1002/9781118335598.ch9</a>.
</div>
<div id="ref-gubianUsingFunctionalData2015" class="csl-entry">
Gubian, Michele, Francisco Torreira, and Lou Boves. 2015. <span>“Using <span>Functional Data Analysis</span> for Investigating Multidimensional Dynamic Phonetic Contrasts.”</span> <em>Journal of Phonetics</em> 49 (March): 16–40. <a href="https://doi.org/10.1016/j.wocn.2014.10.001" class="external-link">https://doi.org/10.1016/j.wocn.2014.10.001</a>.
</div>
<div id="ref-hayTrackingWordFrequency2015a" class="csl-entry">
Hay, Jennifer B., Janet B. Pierrehumbert, Abby J. Walker, and Patrick LaShell. 2015. <span>“Tracking Word Frequency Effects Through 130   Years of Sound Change.”</span> <em>Cognition</em> 139 (June): 83–91. <a href="https://doi.org/10.1016/j.cognition.2015.02.012" class="external-link">https://doi.org/10.1016/j.cognition.2015.02.012</a>.
</div>
<div id="ref-hurringHowStableAreUnderreview" class="csl-entry">
Hurring, Gia, Joshua Wilson Black, Jen Hay, and Lynn Clark. Forthcoming. <span>“How Stable Are Patterns of Covariation Across Time?”</span> <em>Language Variation and Change</em>, Forthcoming.
</div>
<div id="ref-ggcorrplot" class="csl-entry">
Kassambara, Alboukadel. 2023. <em><span class="nocase">ggcorrplot</span>: Visualization of a Correlation Matrix Using <span>“<span class="nocase">ggplot2</span>”</span></em>. <a href="https://CRAN.R-project.org/package=ggcorrplot" class="external-link">https://CRAN.R-project.org/package=ggcorrplot</a>.
</div>
<div id="ref-gganimate" class="csl-entry">
Pedersen, Thomas Lin, and David Robinson. 2024. <em><span class="nocase">gganimate</span>: A Grammar of Animated Graphics</em>. <a href="https://CRAN.R-project.org/package=gganimate" class="external-link">https://CRAN.R-project.org/package=gganimate</a>.
</div>
<div id="ref-podesvaPhonationTypeStylistic2007" class="csl-entry">
Podesva, Robert J. 2007. <span>“Phonation Type as a Stylistic Variable: <span>The</span> Use of Falsetto in Constructing a Persona.”</span> <em>Journal of Sociolinguistics</em> 11 (4): 478–504. <a href="https://doi.org/10.1111/j.1467-9841.2007.00334.x" class="external-link">https://doi.org/10.1111/j.1467-9841.2007.00334.x</a>.
</div>
<div id="ref-base" class="csl-entry">
R Core Team. 2024. <em><span>R</span>: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-sheardRotatingPrincipalComponents2024" class="csl-entry">
Sheard, Elena, and Joshua Wilson Black. 2024. <span>“Rotating <span>Principal Components</span> to Explore Change over the Lifespan in <span>New Zealand English</span> Monophthongs.”</span> Presented at the <span class="nocase">Eighteenth International Conference on Methods in Dialectology</span>, La Trobe University, July 4. <a href="https://joshua.wilsonblack.nz/slides/methods/" class="external-link">https://joshua.wilsonblack.nz/slides/methods/</a>.
</div>
<div id="ref-ggrepel" class="csl-entry">
Slowikowski, Kamil. 2024. <em><span class="nocase">ggrepel</span>: Automatically Position Non-Overlapping Text Labels with <span>“<span class="nocase">ggplot2</span>”</span></em>. <a href="https://CRAN.R-project.org/package=ggrepel" class="external-link">https://CRAN.R-project.org/package=ggrepel</a>.
</div>
<div id="ref-soskuthyGeneralisedAdditiveMixed2017" class="csl-entry">
Sóskuthy, Márton. 2017. <span>“Generalised Additive Mixed Models for Dynamic Analysis in Linguistics: A Practical Introduction.”</span> arXiv.org. March 15, 2017. <a href="https://arxiv.org/abs/1703.05339v1" class="external-link">https://arxiv.org/abs/1703.05339v1</a>.
</div>
<div id="ref-itsadug" class="csl-entry">
van Rij, Jacolien, Martijn Wieling, R. Harald Baayen, and Hedderik van Rijn. 2022. <span>“<span class="nocase">itsadug</span>: Interpreting Time Series and Autocorrelated Data Using GAMMs.”</span>
</div>
<div id="ref-vieiraPermutationTestsEstimate2012" class="csl-entry">
Vieira, Vasco. 2012. <span>“Permutation Tests to Estimate Significances on <span>Principal Components Analysis</span>.”</span> <em>Computational Ecology and Software</em> 2 (June): 103–23.
</div>
<div id="ref-tidyverse" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686" class="external-link">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-wilsonblackVisualisingVowelSpace2022" class="csl-entry">
Wilson Black, Joshua. 2022. <span>“Visualising <span>Vowel Space Change</span> with <span>GAMMs</span>.”</span> <em>Linguistics Methods Hub</em>, Linguistics <span>Methods Hub</span>, October. <a href="https://doi.org/10.5281/zenodo.7261966" class="external-link">https://doi.org/10.5281/zenodo.7261966</a>.
</div>
<div id="ref-wilsonblackUsingPrincipalComponent2023" class="csl-entry">
Wilson Black, Joshua, James Brand, Jen Hay, and Lynn Clark. 2023. <span>“Using Principal Component Analysis to Explore Co‐variation of Vowels.”</span> <em>Language and Linguistics Compass</em> 17 (1): e12479. <a href="https://doi.org/10.1111/lnc3.12479" class="external-link">https://doi.org/10.1111/lnc3.12479</a>.
</div>
<div id="ref-wilsonblackOverlookedEffectAmplitude2023" class="csl-entry">
Wilson Black, Joshua, Jennifer Hay, Lynn Clark, and James Brand. 2023. <span>“The Overlooked Effect of Amplitude on Within-Speaker Vowel Variation.”</span> <em>Linguistics Vanguard</em> 9 (1): 173–89. <a href="https://doi.org/10.1515/lingvan-2022-0086" class="external-link">https://doi.org/10.1515/lingvan-2022-0086</a>.
</div>
<div id="ref-mgcv2017" class="csl-entry">
Wood, S. N. 2017. <em>Generalized Additive Models: An Introduction with r</em>. 2nd ed. Chapman; Hall/CRC.
</div>
<div id="ref-mgcv2003" class="csl-entry">
Wood, S. N. 2003. <span>“Thin-Plate Regression Splines.”</span> <em>Journal of the Royal Statistical Society (B)</em> 65 (1): 95–114.
</div>
<div id="ref-mgcv2004" class="csl-entry">
———. 2004. <span>“Stable and Efficient Multiple Smoothing Parameter Estimation for Generalized Additive Models.”</span> <em>Journal of the American Statistical Association</em> 99 (467): 673–86.
</div>
<div id="ref-mgcv2011" class="csl-entry">
———. 2011. <span>“Fast Stable Restricted Maximum Likelihood and Marginal Likelihood Estimation of Semiparametric Generalized Linear Models.”</span> <em>Journal of the Royal Statistical Society (B)</em> 73 (1): 3–36.
</div>
<div id="ref-mgcv2016" class="csl-entry">
Wood, S. N., N., Pya, and B. S"afken. 2016. <span>“Smoothing Parameter and Model Selection for General Smooth Models (with Discussion).”</span> <em>Journal of the American Statistical Association</em> 111: 1548–75.
</div>
<div id="ref-knitr2014" class="csl-entry">
Xie, Yihui. 2014. <span>“<span class="nocase">knitr</span>: A Comprehensive Tool for Reproducible Research in <span>R</span>.”</span> In <em>Implementing Reproducible Computational Research</em>, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC.
</div>
<div id="ref-knitr2015" class="csl-entry">
———. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-bookdown2016" class="csl-entry">
———. 2016. <em><span class="nocase">bookdown</span>: Authoring Books and Technical Documents with <span>R</span> Markdown</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://bookdown.org/yihui/bookdown" class="external-link">https://bookdown.org/yihui/bookdown</a>.
</div>
<div id="ref-bookdown2025" class="csl-entry">
———. 2025a. <em><span class="nocase">bookdown</span>: Authoring Books and Technical Documents with r Markdown</em>. <a href="https://github.com/rstudio/bookdown" class="external-link">https://github.com/rstudio/bookdown</a>.
</div>
<div id="ref-knitr2025" class="csl-entry">
———. 2025b. <em><span class="nocase">knitr</span>: A General-Purpose Package for Dynamic Report Generation in <span>R</span></em>. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-rmarkdown2018" class="csl-entry">
Xie, Yihui, J. J. Allaire, and Garrett Grolemund. 2018. <em>R Markdown: The Definitive Guide</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://bookdown.org/yihui/rmarkdown" class="external-link">https://bookdown.org/yihui/rmarkdown</a>.
</div>
<div id="ref-rmarkdown2020" class="csl-entry">
Xie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. <em>R Markdown Cookbook</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://bookdown.org/yihui/rmarkdown-cookbook" class="external-link">https://bookdown.org/yihui/rmarkdown-cookbook</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joshua Wilson Black, James Brand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
